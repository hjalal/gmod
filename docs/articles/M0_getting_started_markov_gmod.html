<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M0 gmod: getting started with building Markov models • gmod</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="M0 gmod: getting started with building Markov models">
<meta property="og:description" content="gmod">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gmod</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/D0_getting_started_decision_models.html">D0 getting started with decision models using gmod</a>
    </li>
    <li>
      <a href="../articles/D1_decision_tree_DARTH_HVE_example.html">D1 Decision Tree Herpes Virus Encephalopathy</a>
    </li>
    <li>
      <a href="../articles/D2_gmod_decision_tree.html">D2 Introduction to Decision Trees</a>
    </li>
    <li>
      <a href="../articles/D3_dec_tree_Doubilet_1985_example.html">D3 Herpes Simplex Decision Tree Example Doubilet 1985</a>
    </li>
    <li>
      <a href="../articles/M0_getting_started_markov_gmod.html">M0 gmod: getting started with building Markov models</a>
    </li>
    <li>
      <a href="../articles/M1_gmod_intro_markov_tutorial.html">M1 Introduction to Markov modeling</a>
    </li>
    <li>
      <a href="../articles/M2_gmod_advanced_markov_tutorial.html">M2 Advanced Markov Tutorial for Time Dependent Markov Model</a>
    </li>
    <li>
      <a href="../articles/M3_Markov_age_dep.html">M3 Markov Tutorial Age Dependent</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hjalal/gmod" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>M0 gmod: getting started with building Markov
models</h1>
            
      
      
      <div class="hidden name"><code>M0_getting_started_markov_gmod.Rmd</code></div>

    </div>

    
    
<p><img src="fig1_decision_twigs.png" width="1000"></p>
<p>The purpose of this vignette is to demonstrate how gmod can be used
to build common features of a Markov model. For decision modeling,
please check the getting started with decision modeling vignette.</p>
<p>For a graphical interface to build the gmod syntax, please check <a href="https://www.dashlab.ca/projects/decision_twig/" class="external-link uri">https://www.dashlab.ca/projects/decision_twig/</a>.</p>
<p>This vignette only explains the features one at a time to emphasize
each individual feature. For examples on how to build a complete Markov
model or a decision model, please refer to the detailed introductory and
advanced Markov tutorial vignettes for Markov models, and the Herpes
Simplex Virus (HSV) and the Doubilet vignettes for decision tree
examples.</p>
<div class="section level2">
<h2 id="overview-of-gmod">Overview of gmod:<a class="anchor" aria-label="anchor" href="#overview-of-gmod"></a>
</h2>
<p>gmod is built on the grammar of modeling principle which aims to
describe a model in terms of its main components. The idea is to reduce
the complexity of a decision/Markov model to it’s principal components
(Twigs). gmod is inspired by the grammer of graphics (ggplot) and the
grammar of data wranggling (dplyr) package for data wrangling. Similar
to ggplot which builds a graph by combining layers, gmod then
<em>writes</em> the model code for you!</p>
<div class="section level3">
<h3 id="gmod-functions">gmod functions:<a class="anchor" aria-label="anchor" href="#gmod-functions"></a>
</h3>
<p>gmod has two main external functions. The first function is
<code><a href="../reference/gmod.html">gmod()</a></code> which instantiates the basic gmod object that can be
supplemented with one or more twigs containing the components of the
Markov model.</p>
<p>a gmod syntax for a Markov model currently consist of the following
twigs:</p>
<ul>
<li>
<code>decisions</code>: a single twig that lists the decisions or
strategies that we want to compare</li>
<li>
<code>states</code>: a single twig that describes the Markov states,
their initial probabitlities and the number of tunnel cycles (defaults
to 1).</li>
<li>
<code>event</code>: one or more twig describing, how events control
transition among states. These transitions can be conditional on the
decisions, Markov states, previous events, number of cycles, and number
of cycles in a state (i.e., tunnels).</li>
<li>
<code>payoffs</code>: a single payoff twig, such as costs,
effectiveness, utility, … etc. Similar to the events, these can also
depend on the decisions, Markov states, events, number of cycles, and
number of cycles in a state (i.e., tunnels).</li>
</ul>
<p>The second function is <code><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function()</a></code> which
returns mainly creates a new function named <code>my_markov_model</code>
that represents the model code in standard R that can be run
independently of gmod. This function also returns other useful
information, such as the model structure and the equations involved in
the transition probabilities and payoffs …etc.</p>
<p>The <code>my_markov_model()</code> represents the entire model
structure, and can be called directly. This function takes in a
parameter list <code>param</code> which include the model parameter
values, and returns the Markov results, such as the discounted lifetime
costs and quality adjusted life-years (QALYs). It is important to pass
the number of cycles <code>n_cycles</code> as a parameter as we
discussed below. As described below, in addition to the main payoffs,
this function can also return other intermediate outputs, such as the
transitional probability matrices, the cohort’s Markov trace over time,
and others.</p>
<p>We will start with building a minimal Markov model to illustrate the
basic principles of <code>gmod</code>. Then, we will introduce how to
add other functionality, such as cycle dependency, tunnels…etc. For each
feature, we will only show how to add that feature to reduce complexity.
For full models that contain many of these features in the same model,
please refer to the introductory and advanced Markov tutorials
vignettes.</p>
</div>
</div>
<div class="section level2">
<h2 id="a-minimal-example">A minimal example<a class="anchor" aria-label="anchor" href="#a-minimal-example"></a>
</h2>
<p>We will adapt the sick-sicker model (ref) that we often use in our
DARTH materials and teachings.</p>
<p>First, install gmod using devtools. Also, make sure to enable
use_vignettes so that vignettes render correctly.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#library(devtools)</span></span>
<span><span class="co">#install_github("hjalal/gmod", use_vignettes = TRUE, force = TRUE)</span></span></code></pre></div>
<p>Then, load the <code>gmod</code> library and the
<code>magrittr</code> library needed for the pipe <code>%&gt;%</code>
operator.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; To get started with GMOD, please check the vignettes by typing browseVignettes(package = "gmod").</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="defining-a-basic-markov-model-using-gmod-and-decision-twigs">defining a basic Markov model using gmod() and Decision Twigs<a class="anchor" aria-label="anchor" href="#defining-a-basic-markov-model-using-gmod-and-decision-twigs"></a>
</h3>
<p>We will start with a basic <code><a href="../reference/gmod.html">gmod()</a></code> syntax looks like
this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span>, <span class="st">"StrategyA"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"S"</span>, <span class="st">"D"</span><span class="op">)</span>, init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"only_event"</span>,  </span>
<span>        scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"get_sick"</span>, <span class="st">"die"</span>, <span class="st">"stay"</span><span class="op">)</span>, </span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pGetSick</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, <span class="fu">pDie</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>        outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"D"</span>, <span class="st">"curr_state"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">compute_cost</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To have a graphical representation, we can copy this code into
Decision Twigs to generate the twigs:</p>
<p>Here are the explanation of what each twig does:</p>
<ul>
<li>
<code>decisions("StandardOfCare", "StrategyA")</code>: define the
first twig which is a decision with two strategies involved:
StandardOfCare and StrategyA</li>
<li>
<code>states(...)</code>: defines the Markov twig. There must be
only one of these per model. The states funciton takes in 3 arguments:
<ul>
<li>names: H for healthy, S for sick and D for dead.</li>
<li>init_probs for initial probabilities, and</li>
<li>optional max_cycle_in_states which defines the maximum number of
tunnel states per state. This option is omitted here, so the function
uses the default of 1.</li>
</ul>
</li>
<li>
<code>event(...)</code>: is the most powerful feature in gmod and it
governs how the states are linked through events. In the Grammar of
Modeling we distinguish between a <em>state</em> and an <em>event</em>.
We use a noun for a <code>state</code> to indicate where the cohort
stays a full cycle (e.g., one year), and use a verb to refer to an
<code>event</code>, which in a Markov world is instantaneous and doesn’t
take any time at all (e.g., <code>get_sick</code> for getting sick).
There has to be at least one <code>event</code> twig, but there can be
more events that can be chained together as we explain below. The event
mapping takes in four arguments: name, scenarios, outcomes, and probs.
We will explain each of these separately:
<ul>
<li>
<code>event = "only_event"</code>: defines the event name. Each
event must have a unique name that can be referenced by other events’s
probability statements or payoff equations as described below.</li>
<li>
<code>scenarios = c("get_sick", "die", "stay")</code>: defines the
event scenarios: here the event can only be one of these: getting sick,
dying or staying in the current state.</li>
<li>
<code>probs = c(pGetSick(state), pDie(decision, state), Inf))</code>:
these are the probabilities of the correspondign scenarios occuring. A
powerful feature of gmod is that it allows these probabilities to be
conditional on other model components. Here we define the probability of
only_event==get_sick by calling pGetSick(state) which is dependent on
the state. Similarly, the probability of only_event==die is defined by
calling <code>pDie(decision, state)</code> which we tell gmod that is
dependent on the state and the decision. <code>pGetSick</code> and
<code>pDie</code> are user-defined functions that we describe below. The
<code>Inf</code> is used to tell gmod to compute the complementary
probability for the probability of staying in the same state: (i.e.,
1-pGetSick(state)-pDie(state)) to reduce the amount of typing
needed.</li>
<li>
<code>outcomes = c("S", "D", "curr_state")</code>: defines the
outcomes of each one of the event values. getting sick ends up in the S
state, dying ends up in the D state, and staying will return to
whichever state the cohort was in using the special keyword
<code>"curr_state"</code>.</li>
</ul>
</li>
<li>
<code>payoffs(cost = cost(decision, state))</code>: defines a single
payoff hers. Here we only have a cost payoff that is dependent on the
state and decision. More than one payoff can be described here, but only
a single payoff twig is allowed. And, similar to the probs argument
these can be a function of other model components, such as decision,
state, cycles, events, tunnels, …etc</li>
</ul>
</div>
<div class="section level3">
<h3 id="user-defined-functions-for-probabilities-and-payoffs">User-defined functions for probabilities and payoffs<a class="anchor" aria-label="anchor" href="#user-defined-functions-for-probabilities-and-payoffs"></a>
</h3>
<p>In this section, we define the three functions:
<code>pGetSick</code>, <code>pDie</code> and <code>cost</code> that we
use above in our <code>event_mapping</code> and the
<code><a href="../reference/payoffs.html">payoffs()</a></code> layers above:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pGetSick</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">state</span><span class="op">==</span><span class="st">"H"</span><span class="op">)</span> <span class="fl">0.1</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"H"</span><span class="op">=</span><span class="fl">0.01</span>, </span>
<span>         <span class="st">"S"</span><span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"StrategyA"</span><span class="op">)</span> <span class="fl">0.02</span> <span class="kw">else</span> <span class="fl">0.05</span>, </span>
<span>         <span class="st">"D"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">compute_cost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">cost_state</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"H"</span><span class="op">=</span><span class="fl">1000</span>, <span class="st">"S"</span><span class="op">=</span><span class="fl">5000</span>, <span class="st">"D"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">cost_decision</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"StrategyA"</span> <span class="op">&amp;</span> <span class="va">state</span><span class="op">==</span><span class="st">"S"</span><span class="op">)</span> <span class="fl">2000</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span>  <span class="va">cost_state</span><span class="op">+</span><span class="va">cost_decision</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>pGetSick is a simple function with a single if else statement.
Probability of getting sick is 0.1 if one is Healthy, otherwise is
0.</p>
<p>pDie is a function of bothe the decision and state. Probability of
death is 0.01 if Healthy, 0.02 if sick (+TreatmentA), 0.05 if
Sick+StandardOfCare, and 0 if already dead.</p>
<p>compute_cost calculates the cost of the disease by combining the cost
of the state $1000 if Healthy, $5000 if sick and $0 if Dead. In
addition, it computes the cost of the decision as an additional $2000 if
one receives TreatmentA compared to the standard of care.</p>
<p>As your functions get more complex, we recommended that you test them
to make sure they return outcomes for all possible combinations of
states and decisions and other input arguments. For example, the simple
code below tests the functions for all possible combinations of
decisions and states.</p>
<p>Evaluate the functions</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gmod_expand_functions.html">gmod_expand_functions</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: The dataset  df_compute_cost  created for function  compute_cost .</span></span>
<span><span class="co">#&gt; Note: The dataset  df_pDie  created for function  pDie .</span></span>
<span><span class="co">#&gt; Note: The dataset  df_pGetSick  created for function  pGetSick .</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_pDie</span><span class="op">)</span></span>
<span><span class="co">#&gt;         decision state pDie</span></span>
<span><span class="co">#&gt; 1 StandardOfCare     H 0.01</span></span>
<span><span class="co">#&gt; 2      StrategyA     H 0.01</span></span>
<span><span class="co">#&gt; 3 StandardOfCare     S 0.05</span></span>
<span><span class="co">#&gt; 4      StrategyA     S 0.02</span></span>
<span><span class="co">#&gt; 5 StandardOfCare     D 0.00</span></span>
<span><span class="co">#&gt; 6      StrategyA     D 0.00</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">decision</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span>, <span class="st">"StrategyA"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">state</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"S"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"decision:"</span>, <span class="va">decision</span>, <span class="st">" state:"</span>, <span class="va">state</span>, <span class="st">" pGetSick:"</span>, <span class="fu">pGetSick</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, </span>
<span>        <span class="st">" pDie:"</span>, <span class="fu">pDie</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span><span class="op">)</span>, <span class="st">" cost:"</span>, <span class="fu">compute_cost</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: H  pGetSick: 0.1  pDie: 0.01  cost: 1000 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: S  pGetSick: 0  pDie: 0.05  cost: 5000 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: D  pGetSick: 0  pDie: 0  cost: 0 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: H  pGetSick: 0.1  pDie: 0.01  cost: 1000 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: S  pGetSick: 0  pDie: 0.02  cost: 7000 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: D  pGetSick: 0  pDie: 0  cost: 0</span></span></code></pre></div>
<p>The functions seem to be outputting the correct numbers. switch is
similar to if else, but can be more compact than multiple if else
statements.</p>
</div>
<div class="section level3">
<h3 id="running-the-model">Running the model<a class="anchor" aria-label="anchor" href="#running-the-model"></a>
</h3>
<p>Now we have all the ingredients to run the model.</p>
<p>First, we need to generate the model function code</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_markov(mygmod): Model function my_markov_model is generated. It can be run by calling it directly, for example this function returns the summary results:</span></span>
<span><span class="co">#&gt; my_markov_model(model_struc,params,return_transition_prob=FALSE,return_state_payoffs=FALSE,return_trace=FALSE,return_cycle_payoffs=FALSE,return_payoff_summary=TRUE)</span></span></code></pre></div>
<p>This will create the <code>model_struc</code> which contains the
model equations and formulae and can be examined, and as stated in the
generated note, this function also produces a function representation of
the Markov model. The default name of this function is
<code>my_markov_model.</code></p>
<p>Let’s examine the content of these two object. First, let’s check the
model structure</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_struc</span> <span class="co"># returns the model structure including the formulae before evaluation</span></span>
<span><span class="co">#&gt; $is_cycle_dep</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $decisions</span></span>
<span><span class="co">#&gt; [1] "StandardOfCare" "StrategyA"     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_decisions</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $states</span></span>
<span><span class="co">#&gt; [1] "H" "S" "D"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_states</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $states_expanded</span></span>
<span><span class="co">#&gt; [1] "H" "S" "D"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_states_expanded</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_events</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $p0</span></span>
<span><span class="co">#&gt; $p0$StandardOfCare</span></span>
<span><span class="co">#&gt; H S D </span></span>
<span><span class="co">#&gt; 1 0 0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $p0$StrategyA</span></span>
<span><span class="co">#&gt; H S D </span></span>
<span><span class="co">#&gt; 1 0 0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $events</span></span>
<span><span class="co">#&gt; [1] "only_event"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $events_df</span></span>
<span><span class="co">#&gt;    type      event   values                                    probs   outcomes</span></span>
<span><span class="co">#&gt; 1 event only_event get_sick                          pGetSick(state)          S</span></span>
<span><span class="co">#&gt; 2 event only_event      die                     pDie(decision,state)          D</span></span>
<span><span class="co">#&gt; 3 event only_event     stay 1-(pGetSick(state)+pDie(decision,state)) curr_state</span></span>
<span><span class="co">#&gt;   id</span></span>
<span><span class="co">#&gt; 1  1</span></span>
<span><span class="co">#&gt; 2  2</span></span>
<span><span class="co">#&gt; 3  3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $payoffs</span></span>
<span><span class="co">#&gt; $payoffs$cost</span></span>
<span><span class="co">#&gt; compute_cost(decision, state)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $payoff_names</span></span>
<span><span class="co">#&gt; [1] "cost"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_payoffs</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $discounts</span></span>
<span><span class="co">#&gt; cost </span></span>
<span><span class="co">#&gt;    0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $model_equations</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   dest       probs                                      cost                    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> D          (pDie(decision,state))                     (pDie(decision,state))*…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> S          (pGetSick(state))                          (pGetSick(state))*compu…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> curr_state (1-(pGetSick(state)+pDie(decision,state))) (1-(pGetSick(state)+pDi…</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "gmod_markov"</span></span></code></pre></div>
<p>examining the content of this structure can be helpful to debug a
model by examining the individual layers and formulae. For example
$model_equations returns the probability and cost formulae as plain
text. These can be evaluated by calling them directly if needed. For
example, if we want to know what is the probability of staying at the
Healthy state we can just copy the content of the probs column
corresponding to curr_state and evaluate it with the corresponding
parameters:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fu">pGetSick</span><span class="op">(</span>state<span class="op">=</span><span class="st">"H"</span><span class="op">)</span><span class="op">+</span><span class="fu">pDie</span><span class="op">(</span>decision<span class="op">=</span><span class="st">"StandardOfCare"</span>,state<span class="op">=</span><span class="st">"H"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 0.89</span></span></code></pre></div>
<p>Next, we can also examine the contents of the my_markov_model
function which generates the text.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_markov_model</span> <span class="co">#without parenthesis returns the function text</span></span>
<span><span class="co">#&gt; function (model_struc, params = NULL, return_transition_prob = FALSE, </span></span>
<span><span class="co">#&gt;     return_state_payoffs = FALSE, return_trace = FALSE, return_cycle_payoffs = FALSE, </span></span>
<span><span class="co">#&gt;     return_payoff_summary = TRUE) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (!is.null(params)) </span></span>
<span><span class="co">#&gt;         list2env(params, envir = .GlobalEnv)</span></span>
<span><span class="co">#&gt;     decisions &lt;- model_struc$decisions</span></span>
<span><span class="co">#&gt;     tunnel_lengths &lt;- model_struc$tunnel_lengths</span></span>
<span><span class="co">#&gt;     tunnel_lengths[is.infinite(tunnel_lengths)] &lt;- n_cycles</span></span>
<span><span class="co">#&gt;     n_decisions &lt;- model_struc$n_decisions</span></span>
<span><span class="co">#&gt;     cycles &lt;- 1:n_cycles</span></span>
<span><span class="co">#&gt;     states_expanded &lt;- model_struc$states_expanded</span></span>
<span><span class="co">#&gt;     n_states_expanded &lt;- model_struc$n_states_expanded</span></span>
<span><span class="co">#&gt;     payoff_names &lt;- model_struc$payoff_names</span></span>
<span><span class="co">#&gt;     n_payoffs &lt;- model_struc$n_payoffs</span></span>
<span><span class="co">#&gt;     discounts &lt;- eval(model_struc$discounts)</span></span>
<span><span class="co">#&gt;     P &lt;- array(0, dim = c(n_states_expanded, n_states_expanded, </span></span>
<span><span class="co">#&gt;         n_decisions), dimnames = list(states_expanded, states_expanded, </span></span>
<span><span class="co">#&gt;         decisions))</span></span>
<span><span class="co">#&gt;     state_payoffs &lt;- array(0, dim = c(n_states_expanded, n_decisions, </span></span>
<span><span class="co">#&gt;         n_payoffs), dimnames = list(states_expanded, decisions, </span></span>
<span><span class="co">#&gt;         payoff_names))</span></span>
<span><span class="co">#&gt;     dest &lt;- "D"</span></span>
<span><span class="co">#&gt;     for (decision in decisions) {</span></span>
<span><span class="co">#&gt;         for (state_expanded in states_expanded) {</span></span>
<span><span class="co">#&gt;             state &lt;- state_expanded</span></span>
<span><span class="co">#&gt;             P[state_expanded, dest, decision] &lt;- (pDie(decision, </span></span>
<span><span class="co">#&gt;                 state))</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     dest &lt;- "S"</span></span>
<span><span class="co">#&gt;     for (state_expanded in states_expanded) {</span></span>
<span><span class="co">#&gt;         state &lt;- state_expanded</span></span>
<span><span class="co">#&gt;         P[state_expanded, dest, ] &lt;- (pGetSick(state))</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     dest &lt;- "curr_state"</span></span>
<span><span class="co">#&gt;     for (decision in decisions) {</span></span>
<span><span class="co">#&gt;         for (state_expanded in states_expanded) {</span></span>
<span><span class="co">#&gt;             state &lt;- state_expanded</span></span>
<span><span class="co">#&gt;             dest &lt;- state_expanded</span></span>
<span><span class="co">#&gt;             P[state_expanded, dest, decision] &lt;- P[state_expanded, </span></span>
<span><span class="co">#&gt;                 dest, decision] + (1 - (pGetSick(state) + pDie(decision, </span></span>
<span><span class="co">#&gt;                 state)))</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     for (decision in decisions) {</span></span>
<span><span class="co">#&gt;         for (state_expanded in states_expanded) {</span></span>
<span><span class="co">#&gt;             state &lt;- state_expanded</span></span>
<span><span class="co">#&gt;             state_payoffs[state_expanded, decision, "cost"] &lt;- (pDie(decision, </span></span>
<span><span class="co">#&gt;                 state)) * compute_cost(decision, state) + (pGetSick(state)) * </span></span>
<span><span class="co">#&gt;                 compute_cost(decision, state) + (1 - (pGetSick(state) + </span></span>
<span><span class="co">#&gt;                 pDie(decision, state))) * compute_cost(decision, </span></span>
<span><span class="co">#&gt;                 state)</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     Trace &lt;- array(NA, dim = c(n_cycles, n_states_expanded, n_decisions), </span></span>
<span><span class="co">#&gt;         dimnames = list(cycles, states_expanded, decisions))</span></span>
<span><span class="co">#&gt;     cycle_payoffs &lt;- array(0, dim = c(n_cycles, n_states_expanded, </span></span>
<span><span class="co">#&gt;         n_decisions, n_payoffs), dimnames = list(cycles, states_expanded, </span></span>
<span><span class="co">#&gt;         decisions, payoff_names))</span></span>
<span><span class="co">#&gt;     for (decision in decisions) {</span></span>
<span><span class="co">#&gt;         Trace[1, , decision] &lt;- model_struc$p0[[decision]]</span></span>
<span><span class="co">#&gt;         for (i in 2:n_cycles) {</span></span>
<span><span class="co">#&gt;             P_temp &lt;- P[, , decision]</span></span>
<span><span class="co">#&gt;             Trace[i, , decision] &lt;- Trace[i - 1, , decision] %*% </span></span>
<span><span class="co">#&gt;                 P_temp</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     cycle_ones &lt;- matrix(1, nrow = n_cycles, ncol = 1)</span></span>
<span><span class="co">#&gt;     state_ones &lt;- matrix(1, nrow = 1, ncol = n_states_expanded)</span></span>
<span><span class="co">#&gt;     summary_payoffs &lt;- matrix(0, nrow = n_decisions, ncol = n_payoffs, </span></span>
<span><span class="co">#&gt;         dimnames = list(decisions, payoff_names))</span></span>
<span><span class="co">#&gt;     for (decision in decisions) {</span></span>
<span><span class="co">#&gt;         for (payoff_name in payoff_names) {</span></span>
<span><span class="co">#&gt;             mat_discounts &lt;- matrix(1/(1 + discounts[payoff_name])^(cycles - </span></span>
<span><span class="co">#&gt;                 1), ncol = 1) %*% state_ones</span></span>
<span><span class="co">#&gt;             Payoff_temp &lt;- cycle_ones %*% state_payoffs[, decision, </span></span>
<span><span class="co">#&gt;                 payoff_name]</span></span>
<span><span class="co">#&gt;             cycle_payoffs[, , decision, payoff_name] &lt;- Trace[, </span></span>
<span><span class="co">#&gt;                 , decision] * Payoff_temp * mat_discounts</span></span>
<span><span class="co">#&gt;             summary_payoffs[decision, payoff_name] &lt;- sum(cycle_payoffs[, </span></span>
<span><span class="co">#&gt;                 , decision, payoff_name])</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     model_results &lt;- list()</span></span>
<span><span class="co">#&gt;     if (return_transition_prob) </span></span>
<span><span class="co">#&gt;         model_results$P &lt;- P</span></span>
<span><span class="co">#&gt;     if (return_state_payoffs) </span></span>
<span><span class="co">#&gt;         model_results$state_payoffs &lt;- state_payoffs</span></span>
<span><span class="co">#&gt;     if (return_trace) </span></span>
<span><span class="co">#&gt;         model_results$Trace &lt;- Trace</span></span>
<span><span class="co">#&gt;     if (return_cycle_payoffs) </span></span>
<span><span class="co">#&gt;         model_results$cycle_payoffs &lt;- cycle_payoffs</span></span>
<span><span class="co">#&gt;     if (return_payoff_summary) </span></span>
<span><span class="co">#&gt;         model_results$summary_payoffs &lt;- summary_payoffs</span></span>
<span><span class="co">#&gt;     return(model_results)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;environment: 0x10c0f27b0&gt;</span></span></code></pre></div>
<p>The generated code is build on our introductory and advanced Markov
tutorials in <em>Medical Decision Making</em>. For further information,
please refer to these tutorials.</p>
<p>Now, let’s run the model function and generate our summary results of
running the model for 5 cycles and computing the cumulative cost for our
cohort.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_cycles</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="fu">my_markov_model</span><span class="op">(</span><span class="va">model_struc</span><span class="op">)</span></span>
<span><span class="co">#&gt; $summary_payoffs</span></span>
<span><span class="co">#&gt;                    cost</span></span>
<span><span class="co">#&gt; StandardOfCare 20998.32</span></span>
<span><span class="co">#&gt; StrategyA      28735.17</span></span></code></pre></div>
<p>You can also retrieve the other components of the Markov model run,
such as the Markov trace which shows the proportion of the cohort in
each of the states for each of the 5 cycles.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_results</span> <span class="op">&lt;-</span> <span class="fu">my_markov_model</span><span class="op">(</span><span class="va">model_struc</span>, return_trace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">model_results</span><span class="op">$</span><span class="va">Trace</span></span>
<span><span class="co">#&gt; , , StandardOfCare</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H         S          D</span></span>
<span><span class="co">#&gt; 1  1.0000000 0.0000000 0.00000000</span></span>
<span><span class="co">#&gt; 2  0.8900000 0.1000000 0.01000000</span></span>
<span><span class="co">#&gt; 3  0.7921000 0.1840000 0.02390000</span></span>
<span><span class="co">#&gt; 4  0.7049690 0.2540100 0.04102100</span></span>
<span><span class="co">#&gt; 5  0.6274224 0.3118064 0.06077119</span></span>
<span><span class="co">#&gt; 6  0.5584059 0.3589583 0.08263573</span></span>
<span><span class="co">#&gt; 7  0.4969813 0.3968510 0.10616771</span></span>
<span><span class="co">#&gt; 8  0.4423133 0.4267066 0.13098007</span></span>
<span><span class="co">#&gt; 9  0.3936589 0.4496026 0.15673853</span></span>
<span><span class="co">#&gt; 10 0.3503564 0.4664883 0.18315525</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , StrategyA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H         S          D</span></span>
<span><span class="co">#&gt; 1  1.0000000 0.0000000 0.00000000</span></span>
<span><span class="co">#&gt; 2  0.8900000 0.1000000 0.01000000</span></span>
<span><span class="co">#&gt; 3  0.7921000 0.1870000 0.02090000</span></span>
<span><span class="co">#&gt; 4  0.7049690 0.2624700 0.03256100</span></span>
<span><span class="co">#&gt; 5  0.6274224 0.3277175 0.04486009</span></span>
<span><span class="co">#&gt; 6  0.5584059 0.3839054 0.05768866</span></span>
<span><span class="co">#&gt; 7  0.4969813 0.4320679 0.07095083</span></span>
<span><span class="co">#&gt; 8  0.4423133 0.4731246 0.08456200</span></span>
<span><span class="co">#&gt; 9  0.3936589 0.5078935 0.09844763</span></span>
<span><span class="co">#&gt; 10 0.3503564 0.5371015 0.11254209</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="changing-basic-features-of-our-markov-model">changing basic features of our Markov model:<a class="anchor" aria-label="anchor" href="#changing-basic-features-of-our-markov-model"></a>
</h2>
<p>We start by modifying some of the basic features of our markov model.
We will explore how to change the number of Markov cycles, the initial
probabilities, and the discount rates.</p>
<div class="section level3">
<h3 id="changing-the-number-of-cycles">changing the number of cycles:<a class="anchor" aria-label="anchor" href="#changing-the-number-of-cycles"></a>
</h3>
<p>Changing the number of Markov cycles is straightforward by changing
the <code>n_cycles</code> parameter in the <code>gmod</code> function.
For example, below we change the number of cycles from 5 to 2:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="changing-initial-probabilities">changing initial probabilities:<a class="anchor" aria-label="anchor" href="#changing-initial-probabilities"></a>
</h3>
<p>We can set the initial probabilities in various ways. Most of the
time we start the cohort in the same health state. Above we showed how
to set it up when everyone starts at the Healthy state.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>,<span class="st">"S"</span>,<span class="st">"D"</span><span class="op">)</span>, init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]]$type</span></span>
<span><span class="co">#&gt; [1] "states"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$states</span></span>
<span><span class="co">#&gt; [1] "H" "S" "D"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [[2]]$type</span></span>
<span><span class="co">#&gt; [1] "initial_prob"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$states</span></span>
<span><span class="co">#&gt; [1] "H" "S" "D"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$probs</span></span>
<span><span class="co">#&gt; [1] 1 0 0</span></span></code></pre></div>
<p>However, we can do any distribution we want. For example, we can
define the starting probabilities for all the states.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>,<span class="st">"S"</span>,<span class="st">"D"</span><span class="op">)</span>, init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]]$type</span></span>
<span><span class="co">#&gt; [1] "states"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$states</span></span>
<span><span class="co">#&gt; [1] "H" "S" "D"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [[2]]$type</span></span>
<span><span class="co">#&gt; [1] "initial_prob"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$states</span></span>
<span><span class="co">#&gt; [1] "H" "S" "D"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$probs</span></span>
<span><span class="co">#&gt; [1] 0.7 0.2 0.1</span></span></code></pre></div>
<p>Or, we can even use a combination of variables and Inf as a
placeholder for the complementary probabilities.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pH0</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span><span class="va">pS0</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span><span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>,<span class="st">"S"</span>,<span class="st">"D"</span><span class="op">)</span>, init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pH0</span>, <span class="va">pS0</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]]$type</span></span>
<span><span class="co">#&gt; [1] "states"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$states</span></span>
<span><span class="co">#&gt; [1] "H" "S" "D"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [[2]]$type</span></span>
<span><span class="co">#&gt; [1] "initial_prob"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$states</span></span>
<span><span class="co">#&gt; [1] "H" "S" "D"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$probs</span></span>
<span><span class="co">#&gt; [1] 0.7 0.2 Inf</span></span></code></pre></div>
<p>To run the model with this updated probabilities, we need to add it
as a new <code>init_prob</code> layer to the <code>gmod</code> code.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span>, <span class="st">"StrategyA"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>,<span class="st">"S"</span>,<span class="st">"D"</span><span class="op">)</span>, init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pH0</span>, <span class="va">pS0</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"only_event"</span>,  </span>
<span>              scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"get_sick"</span>, <span class="st">"die"</span>, <span class="st">"stay"</span><span class="op">)</span>, </span>
<span>              probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pGetSick</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, <span class="fu">pDie</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>              outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"D"</span>, <span class="st">"curr_state"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">compute_cost</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># creating the updated function and evaluating it</span></span>
<span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_markov(mygmod): Model function my_markov_model is generated. It can be run by calling it directly, for example this function returns the summary results:</span></span>
<span><span class="co">#&gt; my_markov_model(model_struc,params,return_transition_prob=FALSE,return_state_payoffs=FALSE,return_trace=FALSE,return_cycle_payoffs=FALSE,return_payoff_summary=TRUE)</span></span>
<span><span class="va">model_results</span> <span class="op">&lt;-</span> <span class="fu">my_markov_model</span><span class="op">(</span><span class="va">model_struc</span>, return_trace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">model_results</span><span class="op">$</span><span class="va">Trace</span></span>
<span><span class="co">#&gt; , , StandardOfCare</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H         S         D</span></span>
<span><span class="co">#&gt; 1  0.7000000 0.2000000 0.1000000</span></span>
<span><span class="co">#&gt; 2  0.6230000 0.2600000 0.1170000</span></span>
<span><span class="co">#&gt; 3  0.5544700 0.3093000 0.1362300</span></span>
<span><span class="co">#&gt; 4  0.4934783 0.3492820 0.1572397</span></span>
<span><span class="co">#&gt; 5  0.4391957 0.3811657 0.1796386</span></span>
<span><span class="co">#&gt; 6  0.3908842 0.4060270 0.2030888</span></span>
<span><span class="co">#&gt; 7  0.3478869 0.4248141 0.2272990</span></span>
<span><span class="co">#&gt; 8  0.3096193 0.4383621 0.2520186</span></span>
<span><span class="co">#&gt; 9  0.2755612 0.4474059 0.2770329</span></span>
<span><span class="co">#&gt; 10 0.2452495 0.4525917 0.3021588</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , StrategyA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H         S         D</span></span>
<span><span class="co">#&gt; 1  0.7000000 0.2000000 0.1000000</span></span>
<span><span class="co">#&gt; 2  0.6230000 0.2660000 0.1110000</span></span>
<span><span class="co">#&gt; 3  0.5544700 0.3229800 0.1225500</span></span>
<span><span class="co">#&gt; 4  0.4934783 0.3719674 0.1345543</span></span>
<span><span class="co">#&gt; 5  0.4391957 0.4138759 0.1469284</span></span>
<span><span class="co">#&gt; 6  0.3908842 0.4495179 0.1595979</span></span>
<span><span class="co">#&gt; 7  0.3478869 0.4796160 0.1724971</span></span>
<span><span class="co">#&gt; 8  0.3096193 0.5048124 0.1855683</span></span>
<span><span class="co">#&gt; 9  0.2755612 0.5256780 0.1987607</span></span>
<span><span class="co">#&gt; 10 0.2452495 0.5427206 0.2120299</span></span></code></pre></div>
<p>We can see from the first line of the Trace that H=0.7, S=0.2 and
D=0.1.</p>
<p>gmod tries to check the composition of the probability vector and
returns an error if there are any inconsistencies.</p>
</div>
<div class="section level3">
<h3 id="changing-the-discount-rates">changing the discount rates<a class="anchor" aria-label="anchor" href="#changing-the-discount-rates"></a>
</h3>
<p>Changing the discount rate is similar to setting the initial
probabilities. These can be set for all the payoffs. To illustrate, we
will add an additional payoff (effectiveness), and use a discount rate
of 3% per cycle for both costs and utilities.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span>, <span class="st">"StrategyA"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"S"</span>, <span class="st">"D"</span><span class="op">)</span>, init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"only_event"</span>,  </span>
<span>        scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"get_sick"</span>, <span class="st">"die"</span>, <span class="st">"stay"</span><span class="op">)</span>, </span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pGetSick</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, <span class="fu">pDie</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>        outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"D"</span>, <span class="st">"curr_state"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">compute_cost</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span><span class="op">)</span>, </span>
<span>          effectiveness <span class="op">=</span> <span class="fu">compute_effectiveness</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, </span>
<span>          discount_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define the effectiveness function, the rest of the function will be just like before</span></span>
<span><span class="va">compute_effectiveness</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"H"</span><span class="op">=</span><span class="fl">1</span>, <span class="st">"S"</span><span class="op">=</span><span class="fl">0.7</span>, <span class="st">"D"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># creating the updated function and evaluating it</span></span>
<span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_markov(mygmod): Model function my_markov_model is generated. It can be run by calling it directly, for example this function returns the summary results:</span></span>
<span><span class="co">#&gt; my_markov_model(model_struc,params,return_transition_prob=FALSE,return_state_payoffs=FALSE,return_trace=FALSE,return_cycle_payoffs=FALSE,return_payoff_summary=TRUE)</span></span>
<span><span class="co"># we look at the cycle payoffs which apply the discounts to the cycle payoffs.</span></span>
<span><span class="fu">my_markov_model</span><span class="op">(</span><span class="va">model_struc</span>, return_cycle_payoffs<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $cycle_payoffs</span></span>
<span><span class="co">#&gt; , , StandardOfCare, cost</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H         S D</span></span>
<span><span class="co">#&gt; 1  1000.0000    0.0000 0</span></span>
<span><span class="co">#&gt; 2   864.0777  485.4369 0</span></span>
<span><span class="co">#&gt; 3   746.6302  867.1882 0</span></span>
<span><span class="co">#&gt; 4   645.1465 1162.2757 0</span></span>
<span><span class="co">#&gt; 5   557.4567 1385.1797 0</span></span>
<span><span class="co">#&gt; 6   481.6859 1548.2030 0</span></span>
<span><span class="co">#&gt; 7   416.2140 1661.7823 0</span></span>
<span><span class="co">#&gt; 8   359.6412 1734.7575 0</span></span>
<span><span class="co">#&gt; 9   310.7580 1774.6022 0</span></span>
<span><span class="co">#&gt; 10  268.5190 1787.6224 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , StrategyA, cost</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H         S D</span></span>
<span><span class="co">#&gt; 1  1000.0000    0.0000 0</span></span>
<span><span class="co">#&gt; 2   864.0777  679.6117 0</span></span>
<span><span class="co">#&gt; 3   746.6302 1233.8580 0</span></span>
<span><span class="co">#&gt; 4   645.1465 1681.3806 0</span></span>
<span><span class="co">#&gt; 5   557.4567 2038.2093 0</span></span>
<span><span class="co">#&gt; 6   481.6859 2318.1211 0</span></span>
<span><span class="co">#&gt; 7   416.2140 2532.9503 0</span></span>
<span><span class="co">#&gt; 8   359.6412 2692.8555 0</span></span>
<span><span class="co">#&gt; 9   310.7580 2806.5507 0</span></span>
<span><span class="co">#&gt; 10  268.5190 2881.5051 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , StandardOfCare, effectiveness</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H          S D</span></span>
<span><span class="co">#&gt; 1  1.0000000 0.00000000 0</span></span>
<span><span class="co">#&gt; 2  0.8640777 0.06796117 0</span></span>
<span><span class="co">#&gt; 3  0.7466302 0.12140635 0</span></span>
<span><span class="co">#&gt; 4  0.6451465 0.16271859 0</span></span>
<span><span class="co">#&gt; 5  0.5574567 0.19392516 0</span></span>
<span><span class="co">#&gt; 6  0.4816859 0.21674842 0</span></span>
<span><span class="co">#&gt; 7  0.4162140 0.23264952 0</span></span>
<span><span class="co">#&gt; 8  0.3596412 0.24286605 0</span></span>
<span><span class="co">#&gt; 9  0.3107580 0.24844430 0</span></span>
<span><span class="co">#&gt; 10 0.2685190 0.25026713 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , StrategyA, effectiveness</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H          S D</span></span>
<span><span class="co">#&gt; 1  1.0000000 0.00000000 0</span></span>
<span><span class="co">#&gt; 2  0.8640777 0.06796117 0</span></span>
<span><span class="co">#&gt; 3  0.7466302 0.12338580 0</span></span>
<span><span class="co">#&gt; 4  0.6451465 0.16813806 0</span></span>
<span><span class="co">#&gt; 5  0.5574567 0.20382093 0</span></span>
<span><span class="co">#&gt; 6  0.4816859 0.23181211 0</span></span>
<span><span class="co">#&gt; 7  0.4162140 0.25329503 0</span></span>
<span><span class="co">#&gt; 8  0.3596412 0.26928555 0</span></span>
<span><span class="co">#&gt; 9  0.3107580 0.28065507 0</span></span>
<span><span class="co">#&gt; 10 0.2685190 0.28815051 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $summary_payoffs</span></span>
<span><span class="co">#&gt;                    cost effectiveness</span></span>
<span><span class="co">#&gt; StandardOfCare 18057.18      7.387116</span></span>
<span><span class="co">#&gt; StrategyA      24515.17      7.536633</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="transition-probability-and-payoffs-conditional-on-markov-cycle">Transition probability and payoffs conditional on Markov cycle:<a class="anchor" aria-label="anchor" href="#transition-probability-and-payoffs-conditional-on-markov-cycle"></a>
</h2>
<p>Sometimes we want a probability of transition from one state to
another, or a payoff’s value to depend on the cohort’s age. We can
achieve this by using the special variable cycle for both transition
probabilities and payoffs.</p>
<p>The code below shows the previous code in a single block where we
modify the probability of death and cost payoff to depend on cycle. See
if you can spot the difference:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span>, <span class="st">"StrategyA"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"S"</span>, <span class="st">"D"</span><span class="op">)</span>, init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"only_event"</span>,  </span>
<span>              scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"get_sick"</span>, <span class="st">"die"</span>, <span class="st">"stay"</span><span class="op">)</span>, </span>
<span>              probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pGetSick</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, <span class="fu">pDie</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>              outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"D"</span>, <span class="st">"curr_state"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">compute_cost</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pGetSick</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">state</span><span class="op">==</span><span class="st">"H"</span><span class="op">)</span> <span class="fl">0.1</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"H"</span><span class="op">=</span><span class="fl">0.01</span>, </span>
<span>       <span class="st">"S"</span><span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"StrategyA"</span><span class="op">)</span> <span class="fl">0.02</span> <span class="kw">else</span> <span class="fl">0.05</span>, </span>
<span>       <span class="st">"D"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="va">cycle</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">compute_cost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">cost_state</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"H"</span><span class="op">=</span><span class="fl">1000</span>, <span class="st">"S"</span><span class="op">=</span><span class="fl">5000</span>, <span class="st">"D"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="va">cycle</span></span>
<span>  <span class="va">cost_decision</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"StrategyA"</span> <span class="op">&amp;</span> <span class="va">state</span><span class="op">==</span><span class="st">"S"</span><span class="op">)</span> <span class="fl">2000</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span>  <span class="va">cost_state</span><span class="op">+</span><span class="va">cost_decision</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_markov(mygmod): Model function my_markov_model is generated. It can be run by calling it directly, for example this function returns the summary results:</span></span>
<span><span class="co">#&gt; my_markov_model(model_struc,params,return_transition_prob=FALSE,return_state_payoffs=FALSE,return_trace=FALSE,return_cycle_payoffs=FALSE,return_payoff_summary=TRUE)</span></span></code></pre></div>
<p>Of course, we only need to add the variable cycle to the function
definitions <code>pDie</code> and <code>compute_cost</code> and also
remember to add them to the function calls in the <code>gmod</code>
function. For illustration we assume that <code>pDie</code> and the
<code>cost</code> of the states both increased as a linear function of
the Markov cycles, 1X, 2X, …, 5X for cycles 1 through 5, respectively.
Let’s check first to see that our functions are correct, and then we
will run the model and inspect the outputs.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">decision</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span>, <span class="st">"StrategyA"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">state</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"S"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">cycle</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span> <span class="co"># just print the first two cycles</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"decision:"</span>, <span class="va">decision</span>, <span class="st">" state:"</span>, <span class="va">state</span>, <span class="st">" cycle:"</span>, <span class="va">cycle</span>, <span class="st">" pGetSick:"</span>, <span class="fu">pGetSick</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, </span>
<span>        <span class="st">" pDie:"</span>, <span class="fu">pDie</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle</span><span class="op">)</span>, <span class="st">" cost:"</span>, <span class="fu">compute_cost</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: H  cycle: 1  pGetSick: 0.1  pDie: 0.01  cost: 1000 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: H  cycle: 2  pGetSick: 0.1  pDie: 0.02  cost: 2000 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: S  cycle: 1  pGetSick: 0  pDie: 0.05  cost: 5000 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: S  cycle: 2  pGetSick: 0  pDie: 0.1  cost: 10000 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: D  cycle: 1  pGetSick: 0  pDie: 0  cost: 0 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: D  cycle: 2  pGetSick: 0  pDie: 0  cost: 0 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: H  cycle: 1  pGetSick: 0.1  pDie: 0.01  cost: 1000 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: H  cycle: 2  pGetSick: 0.1  pDie: 0.02  cost: 2000 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: S  cycle: 1  pGetSick: 0  pDie: 0.02  cost: 7000 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: S  cycle: 2  pGetSick: 0  pDie: 0.04  cost: 12000 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: D  cycle: 1  pGetSick: 0  pDie: 0  cost: 0 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: D  cycle: 2  pGetSick: 0  pDie: 0  cost: 0</span></span></code></pre></div>
<p>Now we can examine the impact of this on the model results</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_markov(mygmod): Model function my_markov_model is generated. It can be run by calling it directly, for example this function returns the summary results:</span></span>
<span><span class="co">#&gt; my_markov_model(model_struc,params,return_transition_prob=FALSE,return_state_payoffs=FALSE,return_trace=FALSE,return_cycle_payoffs=FALSE,return_payoff_summary=TRUE)</span></span>
<span><span class="fu">my_markov_model</span><span class="op">(</span><span class="va">model_struc</span><span class="op">)</span></span>
<span><span class="co">#&gt; $summary_payoffs</span></span>
<span><span class="co">#&gt;                     cost</span></span>
<span><span class="co">#&gt; StandardOfCare  64950.86</span></span>
<span><span class="co">#&gt; StrategyA      100340.56</span></span></code></pre></div>
<div class="section level3">
<h3 id="transition-probabilty-and-payoff-dependency-on-the-number-of-cycles-in-a-state-tunnel-states-or-state-residency">Transition probabilty and payoff dependency on the number of cycles
in a state (tunnel states or state residency):<a class="anchor" aria-label="anchor" href="#transition-probabilty-and-payoff-dependency-on-the-number-of-cycles-in-a-state-tunnel-states-or-state-residency"></a>
</h3>
<p>Sometimes we have a different situation where we want to keep track
of how long the cohort has been in a particular state to model
<em>history</em> of a disease. We usually do this by creating what is
called tunnel states and expanding the number of states for example S1,
S2, …, etc. where a transition to S2 is only possible from S1 and to S3
from S2, … etc.</p>
<p>Here we show how to do this again for pDie and compute_cost. We are
only interested of a history of 3 years. Again - can you spot the
difference compared to the minimal model?</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span>, <span class="st">"StrategyA"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"S"</span>, <span class="st">"D"</span><span class="op">)</span>, init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, max_cycle_in_states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co">#</span></span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"only_event"</span>,  </span>
<span>              scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"get_sick"</span>, <span class="st">"die"</span>, <span class="st">"stay"</span><span class="op">)</span>, </span>
<span>              probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pGetSick</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, <span class="fu">pDie</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle_in_state</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>              outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"D"</span>, <span class="st">"curr_state"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">#</span></span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">compute_cost</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle_in_state</span><span class="op">)</span><span class="op">)</span> <span class="co">#</span></span>
<span></span>
<span><span class="va">pGetSick</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">state</span><span class="op">==</span><span class="st">"H"</span><span class="op">)</span> <span class="fl">0.1</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle_in_state</span><span class="op">)</span><span class="op">{</span> <span class="co">#</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"H"</span><span class="op">=</span><span class="fl">0.01</span>, </span>
<span>       <span class="st">"S"</span><span class="op">=</span> <span class="va">cycle_in_state</span> <span class="op">*</span> <span class="kw">if</span> <span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"StrategyA"</span><span class="op">)</span> <span class="fl">0.02</span> <span class="kw">else</span> <span class="fl">0.05</span>, </span>
<span>       <span class="st">"D"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">compute_cost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle_in_state</span><span class="op">)</span><span class="op">{</span> <span class="co">#</span></span>
<span>  <span class="va">cost_state</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"H"</span><span class="op">=</span><span class="fl">1000</span>, <span class="st">"S"</span><span class="op">=</span><span class="fl">5000</span> <span class="op">*</span> <span class="va">cycle_in_state</span>, <span class="st">"D"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span>  <span class="co">#</span></span>
<span>  <span class="va">cost_decision</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"StrategyA"</span> <span class="op">&amp;</span> <span class="va">state</span><span class="op">==</span><span class="st">"S"</span><span class="op">)</span> <span class="fl">2000</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span>  <span class="va">cost_state</span><span class="op">+</span><span class="va">cost_decision</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_markov(mygmod): Model function my_markov_model is generated. It can be run by calling it directly, for example this function returns the summary results:</span></span>
<span><span class="co">#&gt; my_markov_model(model_struc,params,return_transition_prob=FALSE,return_state_payoffs=FALSE,return_trace=FALSE,return_cycle_payoffs=FALSE,return_payoff_summary=TRUE)</span></span></code></pre></div>
<p>It is quite simple to add tunnel dependency by adding the
<code>cycle_in_state</code> variable.</p>
<p>IMPORTANT: when a model has at least on state that has time
dependency, the <code>cycle_in_state</code> variable becomes avaialble
for all the states. States that are not defined in the
<code>tunnels()</code> layer will always return
<code>cycle_in_state=1</code></p>
<p>Similar to above, we assume that the probability of death is a linear
function of the number of cycles in S. For the cost, we also assume that
the longer you stay in S the higher the cost will be - also linearly
related.</p>
<p>The other important change is that we have to add a tunnels() layer
specifying the states that have residency time history dependency. Here
we assume only S has time dependency for 3 cycles only. This can be
expanded to multiple states with various tunnel lengths.</p>
<p>Let’s check first to see that our functions are correct, and then we
will run the model and inspect the outputs.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">decision</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span>, <span class="st">"StrategyA"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">state</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"S"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">cycle_in_state</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span> <span class="co"># just print the first two cycles</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"decision:"</span>, <span class="va">decision</span>, <span class="st">" state:"</span>, <span class="va">state</span>, <span class="st">" cycle_in_state:"</span>, <span class="va">cycle_in_state</span>, <span class="st">" pGetSick:"</span>, <span class="fu">pGetSick</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, </span>
<span>        <span class="st">" pDie:"</span>, <span class="fu">pDie</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle_in_state</span><span class="op">)</span>, <span class="st">" cost:"</span>, <span class="fu">compute_cost</span><span class="op">(</span><span class="va">decision</span>, <span class="va">state</span>, <span class="va">cycle_in_state</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: H  cycle_in_state: 1  pGetSick: 0.1  pDie: 0.01  cost: 1000 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: H  cycle_in_state: 2  pGetSick: 0.1  pDie: 0.01  cost: 1000 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: S  cycle_in_state: 1  pGetSick: 0  pDie: 0.05  cost: 5000 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: S  cycle_in_state: 2  pGetSick: 0  pDie: 0.1  cost: 10000 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: D  cycle_in_state: 1  pGetSick: 0  pDie: 0  cost: 0 </span></span>
<span><span class="co">#&gt; decision: StandardOfCare  state: D  cycle_in_state: 2  pGetSick: 0  pDie: 0  cost: 0 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: H  cycle_in_state: 1  pGetSick: 0.1  pDie: 0.01  cost: 1000 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: H  cycle_in_state: 2  pGetSick: 0.1  pDie: 0.01  cost: 1000 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: S  cycle_in_state: 1  pGetSick: 0  pDie: 0.02  cost: 7000 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: S  cycle_in_state: 2  pGetSick: 0  pDie: 0.04  cost: 12000 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: D  cycle_in_state: 1  pGetSick: 0  pDie: 0  cost: 0 </span></span>
<span><span class="co">#&gt; decision: StrategyA  state: D  cycle_in_state: 2  pGetSick: 0  pDie: 0  cost: 0</span></span></code></pre></div>
<p>Now we can examine the impact of this on the model results</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_markov(mygmod): Model function my_markov_model is generated. It can be run by calling it directly, for example this function returns the summary results:</span></span>
<span><span class="co">#&gt; my_markov_model(model_struc,params,return_transition_prob=FALSE,return_state_payoffs=FALSE,return_trace=FALSE,return_cycle_payoffs=FALSE,return_payoff_summary=TRUE)</span></span>
<span><span class="va">model_results</span> <span class="op">&lt;-</span> <span class="fu">my_markov_model</span><span class="op">(</span><span class="va">model_struc</span>, return_transition_prob <span class="op">=</span> <span class="cn">T</span>, return_state_payoffs <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>Let’s examine the transition probability matrix structure with the
tunnel state</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_results</span><span class="op">$</span><span class="va">P</span> <span class="co"># shows transition probabilities to Death</span></span>
<span><span class="co">#&gt; , , StandardOfCare</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           H S_tnl1 S_tnl2 S_tnl3    D</span></span>
<span><span class="co">#&gt; H      0.89    0.1   0.00   0.00 0.01</span></span>
<span><span class="co">#&gt; S_tnl1 0.00    0.0   0.95   0.00 0.05</span></span>
<span><span class="co">#&gt; S_tnl2 0.00    0.0   0.00   0.90 0.10</span></span>
<span><span class="co">#&gt; S_tnl3 0.00    0.0   0.00   0.85 0.15</span></span>
<span><span class="co">#&gt; D      0.00    0.0   0.00   0.00 1.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , StrategyA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           H S_tnl1 S_tnl2 S_tnl3    D</span></span>
<span><span class="co">#&gt; H      0.89    0.1   0.00   0.00 0.01</span></span>
<span><span class="co">#&gt; S_tnl1 0.00    0.0   0.98   0.00 0.02</span></span>
<span><span class="co">#&gt; S_tnl2 0.00    0.0   0.00   0.96 0.04</span></span>
<span><span class="co">#&gt; S_tnl3 0.00    0.0   0.00   0.94 0.06</span></span>
<span><span class="co">#&gt; D      0.00    0.0   0.00   0.00 1.00</span></span></code></pre></div>
<p>This returns a list of two 5x5 matrices for the transition
probabilities of the two strategies. These matrices describe the
probability of transition from an origin state (row) to a destination
state (column). Now notice that S is being replaced by S_tnl1, S_tnl2
and S_tnl3 indicating the three cycles in S as separate states. Also
notice the special way transitions occur among these states. i.e., each
tunnel state goes to the next one, but never back or stay in the same
state except for the last state in the tunnel, here S_tnl3. Since we
made the probability of death a function of the tunnel state, we can see
that the probabiltiy of death for StandardOfCare (last column) for
S_tnl1 = 0.05, S_tnl2=0.10 and S_tnl3=0.15 as we specified in our
function. Similarly, the probability of death under StrategyA also
incrases linearly from 0.02 for S_tnl1, to 0.04 for S_tnl2 and 0.06 for
S_tnl3.</p>
<p>And, let’s examine the cycle payoffs.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_results</span><span class="op">$</span><span class="va">state_payoffs</span> <span class="co"># shows cycle payoffs of the Sick state</span></span>
<span><span class="co">#&gt; , , cost</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        StandardOfCare StrategyA</span></span>
<span><span class="co">#&gt; H                1000      1000</span></span>
<span><span class="co">#&gt; S_tnl1           5000      7000</span></span>
<span><span class="co">#&gt; S_tnl2          10000     12000</span></span>
<span><span class="co">#&gt; S_tnl3          15000     17000</span></span>
<span><span class="co">#&gt; D                   0         0</span></span></code></pre></div>
<p>Here you can see that for each year in S, the cost increases by
$5000.</p>
</div>
</div>
<div class="section level2">
<h2 id="multiple-events-">Multiple Events.<a class="anchor" aria-label="anchor" href="#multiple-events-"></a>
</h2>
<p>It is relatively easy to add additional events to a Markov model.
Please keep in mind that Events are quite flexible and are central to
the Grammar of Modeling framework. While users are free to make
branching events, we recommend to use a single linear sequence of
events, and call previous event values to make the same sequence apply
to all decisions and states. For example, if an event doesn’t happen for
a particular decision (e.g., getting a side effect), then one can make
the get_side_effect event a function of the decision, and only have a
non-zero probability for that particular treatment. The Grammer of
Modeling is designed aroudn the concept of a single sequence of events
as it makes the code more concise and easier to manage.</p>
<p>Below we slightly modify the minimal example by converting the Sick
state to an event. Assume that Sick is an acute disease that only takes
a few days rather than a full cycle. We will have a sequence of events
<code>get_sick</code> followed by <code>die</code>. Because Sick is no
longer a state, we will use these two health states Alive and Dead and
show how the probability of death can be a function of the event
get_sick occuring before the event die. In addition, we will show how
the cost can also be a function of the value of the sick_event. We will
also look at one strategy “StandardOfCare to simplify the
illustration.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Alive"</span>, <span class="st">"Dead"</span><span class="op">)</span>, init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"get_sick"</span>,  </span>
<span>              scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>              probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>              outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"die"</span>, <span class="st">"die"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"die"</span>,  </span>
<span>              scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>              probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pDie</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>              outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dead"</span>, <span class="st">"curr_state"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">compute_cost</span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># if the cohort gets sick, the probability of death = 0.01 otherwise it is 0.1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"Alive"</span><span class="op">=</span><span class="fl">0.01</span>,  </span>
<span>                <span class="st">"Dead"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">compute_cost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">cost_state</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"Alive"</span><span class="op">=</span><span class="fl">1000</span>, <span class="st">"Dead"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="co"># add 2000 if someone in the Alive state gets sick</span></span>
<span>  <span class="va">cost_state</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_markov(mygmod): Model function my_markov_model is generated. It can be run by calling it directly, for example this function returns the summary results:</span></span>
<span><span class="co">#&gt; my_markov_model(model_struc,params,return_transition_prob=FALSE,return_state_payoffs=FALSE,return_trace=FALSE,return_cycle_payoffs=FALSE,return_payoff_summary=TRUE)</span></span>
<span><span class="fu">my_markov_model</span><span class="op">(</span><span class="va">model_struc</span>,return_transition_prob<span class="op">=</span><span class="cn">TRUE</span>,return_state_payoffs<span class="op">=</span><span class="cn">TRUE</span>,return_trace<span class="op">=</span><span class="cn">TRUE</span>,return_cycle_payoffs<span class="op">=</span><span class="cn">TRUE</span>,return_payoff_summary<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $P</span></span>
<span><span class="co">#&gt; , , StandardOfCare</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       Alive Dead</span></span>
<span><span class="co">#&gt; Alive  0.99 0.01</span></span>
<span><span class="co">#&gt; Dead   0.00 1.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $state_payoffs</span></span>
<span><span class="co">#&gt; , , cost</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       StandardOfCare</span></span>
<span><span class="co">#&gt; Alive           1000</span></span>
<span><span class="co">#&gt; Dead               0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Trace</span></span>
<span><span class="co">#&gt; , , StandardOfCare</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Alive       Dead</span></span>
<span><span class="co">#&gt; 1  1.0000000 0.00000000</span></span>
<span><span class="co">#&gt; 2  0.9900000 0.01000000</span></span>
<span><span class="co">#&gt; 3  0.9801000 0.01990000</span></span>
<span><span class="co">#&gt; 4  0.9702990 0.02970100</span></span>
<span><span class="co">#&gt; 5  0.9605960 0.03940399</span></span>
<span><span class="co">#&gt; 6  0.9509900 0.04900995</span></span>
<span><span class="co">#&gt; 7  0.9414801 0.05851985</span></span>
<span><span class="co">#&gt; 8  0.9320653 0.06793465</span></span>
<span><span class="co">#&gt; 9  0.9227447 0.07725531</span></span>
<span><span class="co">#&gt; 10 0.9135172 0.08648275</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cycle_payoffs</span></span>
<span><span class="co">#&gt; , , StandardOfCare, cost</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Alive Dead</span></span>
<span><span class="co">#&gt; 1  1000.0000    0</span></span>
<span><span class="co">#&gt; 2   990.0000    0</span></span>
<span><span class="co">#&gt; 3   980.1000    0</span></span>
<span><span class="co">#&gt; 4   970.2990    0</span></span>
<span><span class="co">#&gt; 5   960.5960    0</span></span>
<span><span class="co">#&gt; 6   950.9900    0</span></span>
<span><span class="co">#&gt; 7   941.4801    0</span></span>
<span><span class="co">#&gt; 8   932.0653    0</span></span>
<span><span class="co">#&gt; 9   922.7447    0</span></span>
<span><span class="co">#&gt; 10  913.5172    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $summary_payoffs</span></span>
<span><span class="co">#&gt;                    cost</span></span>
<span><span class="co">#&gt; StandardOfCare 9561.792</span></span></code></pre></div>
<p>Notice that now we have two sequential events. The first event is
get_sick, the second one is die. Here get_sick doesn’t do much because
if the cohort gets sick or not, they face the next event die. Next, we
will show how to make the probabilit of death a function of the event
get_sick and also make the cost also a function of this event.</p>
</div>
<div class="section level2">
<h2 id="transition-and-payoff-dependent-on-prior-events">Transition and Payoff dependent on prior events<a class="anchor" aria-label="anchor" href="#transition-and-payoff-dependent-on-prior-events"></a>
</h2>
<p>In the previous section, we illustrated how to add multiple
sequential events. gmod can also use these prior events to influence the
transition probabilities downstream and the payoffs. This can be
particularly important to put all the events on a single sequence across
decisions and states. Traditional models often duplicate (copy or clone)
these events which creates a nested branching problem that can be
difficult to manage and troubleshoot.</p>
<p>The other advantage of being able to refer to any event value is the
ability to associate payoffs to events. This is often referred to as
transitional rewards or payoffs because these payoffs occur when an
event occurs. These payoffs are quite different from state payoffs as
state payoffs are associated with spending time in states compared to
event (transitional) payoffs which are associated with the events that
are considered instantaneous and only happens for a portion of the
cohort residing in a state.</p>
<p>Below we modify the previous example by making the probability of
death a function of the event get_sick occurring upstream. In addition,
we will show how the cost can also be a function of the value of the
sick_event. We will also look at one strategy “StandardOfCare to
simplify the illustration.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Alive"</span>, <span class="st">"Dead"</span><span class="op">)</span>, init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"get_sick"</span>,  </span>
<span>              scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>              probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>              outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"die"</span>, <span class="st">"die"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>    <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"die"</span>,  </span>
<span>              scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>              probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pDie</span><span class="op">(</span><span class="va">state</span>, <span class="va">get_sick</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>              outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dead"</span>, <span class="st">"curr_state"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">compute_cost</span><span class="op">(</span><span class="va">state</span>, <span class="va">get_sick</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">get_sick</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># if the cohort gets sick, the probability of death = 0.01 otherwise it is 0.1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"Alive"</span><span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">get_sick</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span> <span class="fl">0.1</span> <span class="kw">else</span> <span class="fl">0.01</span>,  </span>
<span>                <span class="st">"Dead"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">compute_cost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">get_sick</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">cost_state</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"Alive"</span><span class="op">=</span><span class="fl">1000</span>, <span class="st">"Dead"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="co"># add 2000 if someone in the Alive state gets sick</span></span>
<span>  <span class="va">cost_get_sick</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">get_sick</span><span class="op">==</span><span class="cn">TRUE</span> <span class="op">&amp;</span> <span class="va">state</span><span class="op">==</span><span class="st">"Alive"</span><span class="op">)</span> <span class="fl">2000</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span>  <span class="va">cost_state</span><span class="op">+</span><span class="va">cost_get_sick</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Notice that now we have two sequential events. The first event is
die, the second one is get_sick. Now, if die=TRUE, then the cohort moves
to the state D, but if D=FALSE, then the cohort moves to the next event
get_sick. Then, if get_sick=TRUE, then the cohort moves to the state S,
but if not, they will stay in their current state.</p>
<p>The rest of the user-functions can stay the same. Below we show how
to use prior events to influence the probability of transition and the
payoffs.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="kw">for</span> <span class="op">(</span><span class="va">state</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Alive"</span>, <span class="st">"Dead"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="kw">for</span> <span class="op">(</span><span class="va">get_sick</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co"># just print the first two cycles</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">" state:"</span>, <span class="va">state</span>, <span class="st">" get_sick:"</span>, <span class="va">get_sick</span>, <span class="co">#</span></span>
<span>       <span class="st">" pDie:"</span>, <span class="fu">pDie</span><span class="op">(</span><span class="va">state</span>, <span class="va">get_sick</span><span class="op">)</span>, <span class="st">" cost:"</span>, <span class="fu">compute_cost</span><span class="op">(</span><span class="va">state</span>, <span class="va">get_sick</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>   <span class="op">}</span></span>
<span> <span class="op">}</span></span>
<span><span class="co">#&gt;  state: Alive  get_sick: TRUE  pDie: 0.1  cost: 3000 </span></span>
<span><span class="co">#&gt;  state: Alive  get_sick: FALSE  pDie: 0.01  cost: 1000 </span></span>
<span><span class="co">#&gt;  state: Dead  get_sick: TRUE  pDie: 0  cost: 0 </span></span>
<span><span class="co">#&gt;  state: Dead  get_sick: FALSE  pDie: 0  cost: 0</span></span></code></pre></div>
<p>Now we can examine the impact of this on the model results</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_markov(mygmod): Model function my_markov_model is generated. It can be run by calling it directly, for example this function returns the summary results:</span></span>
<span><span class="co">#&gt; my_markov_model(model_struc,params,return_transition_prob=FALSE,return_state_payoffs=FALSE,return_trace=FALSE,return_cycle_payoffs=FALSE,return_payoff_summary=TRUE)</span></span>
<span><span class="fu">my_markov_model</span><span class="op">(</span><span class="va">model_struc</span>,return_transition_prob<span class="op">=</span><span class="cn">TRUE</span>,return_state_payoffs<span class="op">=</span><span class="cn">TRUE</span>,return_trace<span class="op">=</span><span class="cn">TRUE</span>,return_cycle_payoffs<span class="op">=</span><span class="cn">TRUE</span>,return_payoff_summary<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $P</span></span>
<span><span class="co">#&gt; , , StandardOfCare</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Alive   Dead</span></span>
<span><span class="co">#&gt; Alive 0.9855 0.0145</span></span>
<span><span class="co">#&gt; Dead  0.0000 1.0000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $state_payoffs</span></span>
<span><span class="co">#&gt; , , cost</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       StandardOfCare</span></span>
<span><span class="co">#&gt; Alive           1100</span></span>
<span><span class="co">#&gt; Dead               0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Trace</span></span>
<span><span class="co">#&gt; , , StandardOfCare</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Alive       Dead</span></span>
<span><span class="co">#&gt; 1  1.0000000 0.00000000</span></span>
<span><span class="co">#&gt; 2  0.9855000 0.01450000</span></span>
<span><span class="co">#&gt; 3  0.9712103 0.02878975</span></span>
<span><span class="co">#&gt; 4  0.9571277 0.04287230</span></span>
<span><span class="co">#&gt; 5  0.9432493 0.05675065</span></span>
<span><span class="co">#&gt; 6  0.9295722 0.07042777</span></span>
<span><span class="co">#&gt; 7  0.9160934 0.08390656</span></span>
<span><span class="co">#&gt; 8  0.9028101 0.09718992</span></span>
<span><span class="co">#&gt; 9  0.8897193 0.11028066</span></span>
<span><span class="co">#&gt; 10 0.8768184 0.12318159</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cycle_payoffs</span></span>
<span><span class="co">#&gt; , , StandardOfCare, cost</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Alive Dead</span></span>
<span><span class="co">#&gt; 1  1100.0000    0</span></span>
<span><span class="co">#&gt; 2  1084.0500    0</span></span>
<span><span class="co">#&gt; 3  1068.3313    0</span></span>
<span><span class="co">#&gt; 4  1052.8405    0</span></span>
<span><span class="co">#&gt; 5  1037.5743    0</span></span>
<span><span class="co">#&gt; 6  1022.5295    0</span></span>
<span><span class="co">#&gt; 7  1007.7028    0</span></span>
<span><span class="co">#&gt; 8   993.0911    0</span></span>
<span><span class="co">#&gt; 9   978.6913    0</span></span>
<span><span class="co">#&gt; 10  964.5002    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $summary_payoffs</span></span>
<span><span class="co">#&gt;                    cost</span></span>
<span><span class="co">#&gt; StandardOfCare 10309.31</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-our-model-with-other-parameter-values">Running our model with other parameter values<a class="anchor" aria-label="anchor" href="#running-our-model-with-other-parameter-values"></a>
</h2>
<p>gmod allows using variables inside the custom functions. These values
must be defined in the global environment so that they are accessible
within all the functions. To illustrate the use of parameters, we can
begin by creating a new list (params) that contains 4 parameters as
shown below. In the functions below we replace the values with the
variable names we use in the params list. For example, we will use
pDieSick in the params = 0.1, and replace the 0.1 we used in the pDie
function with the variable name pDieSick. We do the same for the other
variables.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pDieSick <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>               pDieNotSick <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>               costAlive <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>               costGetSick <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Alive"</span>, <span class="st">"Dead"</span><span class="op">)</span>, init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"get_sick"</span>,  </span>
<span>              scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>              probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>              outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"die"</span>, <span class="st">"die"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>    <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"die"</span>,  </span>
<span>              scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>              probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pDie</span><span class="op">(</span><span class="va">state</span>, <span class="va">get_sick</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>              outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dead"</span>, <span class="st">"curr_state"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">compute_cost</span><span class="op">(</span><span class="va">state</span>, <span class="va">get_sick</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">get_sick</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># if the cohort gets sick, the probability of death = 0.01 otherwise it is 0.1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"Alive"</span><span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">get_sick</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span> <span class="va">pDieSick</span> <span class="kw">else</span> <span class="va">pDieNotSick</span>,  </span>
<span>                <span class="st">"Dead"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">compute_cost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">get_sick</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">cost_state</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"Alive"</span><span class="op">=</span><span class="va">costAlive</span>, <span class="st">"Dead"</span><span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="co"># add 2000 if someone in the Alive state gets sick</span></span>
<span>  <span class="va">cost_get_sick</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">get_sick</span><span class="op">==</span><span class="cn">TRUE</span> <span class="op">&amp;</span> <span class="va">state</span><span class="op">==</span><span class="st">"Alive"</span><span class="op">)</span> <span class="va">costGetSick</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span>  <span class="va">cost_state</span><span class="op">+</span><span class="va">cost_get_sick</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_markov(mygmod): Model function my_markov_model is generated. It can be run by calling it directly, for example this function returns the summary results:</span></span>
<span><span class="co">#&gt; my_markov_model(model_struc,params,return_transition_prob=FALSE,return_state_payoffs=FALSE,return_trace=FALSE,return_cycle_payoffs=FALSE,return_payoff_summary=TRUE)</span></span>
<span><span class="fu">my_markov_model</span><span class="op">(</span><span class="va">model_struc</span>,params<span class="op">=</span><span class="va">params</span><span class="op">)</span></span>
<span><span class="co">#&gt; $summary_payoffs</span></span>
<span><span class="co">#&gt;                    cost</span></span>
<span><span class="co">#&gt; StandardOfCare 10309.31</span></span></code></pre></div>
<p>gmod allows passing parameter values as a list. The values passed in
the list replace the parameter values in the global environment.</p>
<div class="section level3">
<h3 id="rerunnign-the-model-with-a-different-set-of-parameter-values">Rerunnign the model with a different set of parameter values<a class="anchor" aria-label="anchor" href="#rerunnign-the-model-with-a-different-set-of-parameter-values"></a>
</h3>
<p>Now, we can simply change the values of the parameter list and rerun
the model by simply calling it with a different parameter values. For
example, we change the value of pDieSick to 0.3 from 0.1, and change the
costGetSick to 10000 from 2000.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pDieSick <span class="op">=</span> <span class="fl">0.3</span>, <span class="co"># was 0.1</span></span>
<span>               pDieNotSick <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>               costAlive <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>               costGetSick <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> <span class="co"># was 2000</span></span>
<span><span class="fu">my_markov_model</span><span class="op">(</span><span class="va">model_struc</span>,params<span class="op">=</span><span class="va">params</span><span class="op">)</span></span>
<span><span class="co">#&gt; $summary_payoffs</span></span>
<span><span class="co">#&gt;                   cost</span></span>
<span><span class="co">#&gt; StandardOfCare 13449.8</span></span></code></pre></div>
<p>Being able to pass parameters as a list can be helpful when we
conduct analyses using the gmod structure. For example, if we want to
run a probabilistic sensitivity analysis, deterministic analyses, do
value of information, or calibrate our model.</p>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary:<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>In this Vignette we went over the basic features of the gmod library
for building and running Markov models. We illustrated these features
one at a time, and show how to define decisions, states, events,
payoffs. In addition, we show how to change the number of cycles, the
discounting rates. Furthermore, we show how to make transition
probabilities and payoffs a function of decisions, states cycles, number
of cycles in a state (tunnel) and previous events.</p>
<p>For further details on gmod, please refer to the other vignettes,
mainly the introductory and advanced Markov model tutorial vignettes
that replicate our anlayses published in <em>Medical Decision
Making</em>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Hawre Jalal.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
