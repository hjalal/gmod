<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D0 getting started with decision models using gmod • gmod</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="D0 getting started with decision models using gmod">
<meta property="og:description" content="gmod">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gmod</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/D0_getting_started_decision_models.html">D0 getting started with decision models using gmod</a>
    </li>
    <li>
      <a href="../articles/D1_decision_tree_DARTH_HVE_example.html">D1 Decision Tree Herpes Virus Encephalopathy</a>
    </li>
    <li>
      <a href="../articles/D2_gmod_decision_tree.html">D2 Introduction to Decision Trees</a>
    </li>
    <li>
      <a href="../articles/D3_dec_tree_Doubilet_1985_example.html">D3 Herpes Simplex Decision Tree Example Doubilet 1985</a>
    </li>
    <li>
      <a href="../articles/M0_getting_started_markov_gmod.html">M0 gmod: getting started with building Markov models</a>
    </li>
    <li>
      <a href="../articles/M1_gmod_intro_markov_tutorial.html">M1 Introduction to Markov modeling</a>
    </li>
    <li>
      <a href="../articles/M2_gmod_advanced_markov_tutorial.html">M2 Advanced Markov Tutorial for Time Dependent Markov Model</a>
    </li>
    <li>
      <a href="../articles/M3_Markov_age_dep.html">M3 Markov Tutorial Age Dependent</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hjalal/gmod" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>D0 getting started with decision models using
gmod</h1>
                        <h4 data-toc-skip class="author">Hawre Jalal <a href="mailto:hjalal@uottawa.ca" class="email">hjalal@uottawa.ca</a>
</h4>
            
      
      
      <div class="hidden name"><code>D0_getting_started_decision_models.Rmd</code></div>

    </div>

    
    
<p>The purpose of this vignette is to demonstrate how gmod can be used
to build common features of a decision model. For a Markov modeling,
please check the getting started with decision modeling vignette.</p>
<p>This vignette only explains the features one at a time to emphasize
the feature and reduce complexity. For examples on getting started with
Markov models instead please check the getting started with Markov model
vignette and the introductory and advanced tutorial vignettes.</p>
<p>For a full decision tree model, please check the Herpes Simplex Virus
(HSV) and the Doubilet vignettes.</p>
<div class="section level2">
<h2 id="overview-of-gmod">Overview of gmod:<a class="anchor" aria-label="anchor" href="#overview-of-gmod"></a>
</h2>
<p>gmod is build on the grammar of modeling principle which describes a
model using a simple syntax. gmod is inspired by the grammer of graphics
(ggplot) package. Similar to ggplot which builds a graph by combining
layers, gmod then <em>writes</em> the model code for you!</p>
<div class="section level3">
<h3 id="gmod-functions">gmod functions:<a class="anchor" aria-label="anchor" href="#gmod-functions"></a>
</h3>
<p>gmod has two main functions. The first function is
<code><a href="../reference/gmod.html">gmod()</a></code> which takes in the type of the model (for now:
<code>decision</code> and <code>Markov</code>), and the number of cycles
<code>n_cycles</code> (if Markov), and creates a basic <code>gmod</code>
object which can be supplemented with one or more layers containing the
components of our deicsion.</p>
<p>gmod layers of a decision tree consist of the following:</p>
<ul>
<li>
<code>decisions</code>: the decisions or strategies that we want to
compare</li>
<li>
<code>event_mapping</code>: can be one or more. these describe how
events control transition among various outcomes conditional on the
decisions and previous events.</li>
<li>
<code>payoffs</code>: the payoffs, such as costs, effectiveness,
utility, … etc. Similar to the event probabilities, these can also
depend on the decisions and prior events.</li>
</ul>
<p>The second function is <code><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function()</a></code> which
returns does two things:</p>
<ol style="list-style-type: decimal">
<li>it creates the model code as a new function named
<code>my_decision_model</code> by default.</li>
<li>it returns the model structure, which is a list containing the
parsed objects from the gmod objects, such as a the equations involved
in the final outcome probabilities and payoffs. This structure is needed
for running the model function.</li>
</ol>
<p>The <code>my_decision_model()</code> represents the entire model
structure, and can be called directly. This function takes in a
parameter list <code>param</code> a model parameter values, and returns
the results of the decision model, such as the discounted lifetime costs
and quality adjusted life-years (QALYs). It can also return other
intermediate outcomes, such as the event probabilities and payoffs.
Please see the function definition and the documentations.</p>
<p>We will start with building a minimal decision model to illustrate
the basic structure. Then, we will introduce how to add other features.
For each feature, we will only show how to add that feature to reduce
complexity. For full models that contain many of these features in the
same model, please refer to the HSE and Doubilet et al vignettes.</p>
</div>
</div>
<div class="section level2">
<h2 id="a-minimal-example">A minimal example<a class="anchor" aria-label="anchor" href="#a-minimal-example"></a>
</h2>
<p>We will adapt the sick-sicker model (ref) that we often use in our
DARTH materials and teachings.</p>
<p>First, install gmod using devtools. Also, make sure to enable
use_vignettes so that vignettes render correctly.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#library(devtools)</span></span>
<span><span class="co">#install_github("hjalal/gmod", use_vignettes = TRUE, force = TRUE)</span></span></code></pre></div>
<p>Then, load the <code>gmod</code> library and the
<code>magrittr</code> library needed for the pipe <code>%&gt;%</code>
operator.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; To get started with GMOD, please check the vignettes by typing browseVignettes(package = "gmod").</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="defining-a-basic-decision-tree-using-gmod">defining a basic Decision tree using gmod()<a class="anchor" aria-label="anchor" href="#defining-a-basic-decision-tree-using-gmod"></a>
</h3>
<p>We will start with a simple decision tree to analyze the outcome of a
person who recently broke their leg in a rock-climbing accident. The
wound is infected and there are two options for treatment either
amputate which lowers quality of life but has less probability of dying
or antibiotics which saves the leg but has higher probability of
death.</p>
<p>We can write this decision problem in <code><a href="../reference/gmod.html">gmod()</a></code> as:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"Amputate"</span>, <span class="st">"Antibiotics"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"die"</span>,  </span>
<span>            scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">T</span>, <span class="cn">F</span><span class="op">)</span>, </span>
<span>            probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pDie</span><span class="op">(</span><span class="va">decision</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>            outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dead"</span>, <span class="st">"Alive"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>utility <span class="op">=</span> <span class="fu">compute_utility</span><span class="op">(</span><span class="va">decision</span>, <span class="va">die</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here are the explanation of what each layer does:</p>
<ul>
<li>
<code>gmod(model_type = "Decision")</code>: creates the basic gmod
object of type Decision.</li>
<li>
<code>decisions("Amputate", "Antibiotics")</code>: define the two
strategies involved.</li>
<li>
<code>states("H", "S", "D")</code>: defines the Markov states: H for
healthy, S for sick and D for dead.</li>
<li>
<code>initial_probs(states = "H", probs = 1)</code>: defines that
everyone starts in the healthy states. See the function documentation
for more variations.</li>
<li>
<code>event_mapping(...)</code>: is the most important feature in
gmod and it governs how the states are linked through events. There has
to be at least one <code>event_mapping</code> layer, but there can be
more events that can be linked to each other as we explain below. The
event mapping takes in four arguments: event, values, outcomes, probs.
We will explain each of these separately:
<ul>
<li>
<code>event = "die"</code>: defines the event name. Each event must
have a unique name that can be referenced by other evnets.</li>
<li>
<code>values = c(T, F)</code>: defines the values of that event:
here <code>die</code> is a binary event and can be either
<code>TRUE</code> of <code>FALSE</code>. multiple values are also
possible.<br>
</li>
<li>
<code>probs = c(pDie(decision), Inf))</code>: these are the
probabilities of the event values. A flexible feature of gmod is that it
allows these probabilities to be conditional on other model components.
For decision trees, these probabilities can be functions of the
decisions and the prior event values as we will explain below. Here we
define pDie(decision) which only depends on the decision as there is
only a single event (die). In the next section, we define
<code>pDie</code>. The <code>Inf</code> is used to tell gmod to compute
the complementary probability (i.e., 1-pDie(decision)) to reduce the
amount of typing needed.</li>
<li>
<code>outcomes = c("Dead", "Alive")</code>: defines the outcomes of
each one of the event values. <code>die==TRUE</code> will end up in the
outcome <code>Dead</code>, and <code>die==FALSE</code> ends up in the
Alive outcome.<br>
</li>
</ul>
</li>
<li>
<code>payoffs(utility = compute_utility(decision, state))</code>:
defines the payoffs. Here we only have a utility payoff that is
dependent on the decision. More than one payoff can be described here.
And, similar to the probs argument these can be a function of other
model components, such as the decision and prior event values.</li>
</ul>
</div>
<div class="section level3">
<h3 id="user-defined-functions-for-probabilities-and-payoffs">User-defined functions for probabilities and payoffs<a class="anchor" aria-label="anchor" href="#user-defined-functions-for-probabilities-and-payoffs"></a>
</h3>
<p>In this section, we define the two functions: <code>pDie</code> and
<code>compute_utility</code> that we use above in our
<code>event_mapping</code> and the <code><a href="../reference/payoffs.html">payoffs()</a></code> layers
above:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># probability of death is 0.99 if the leg amputated and 0.8 if antibiotics given instead.</span></span>
<span><span class="va">pDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">decision</span> <span class="op">==</span> <span class="st">"Amputate"</span><span class="op">)</span> <span class="fl">0.01</span> <span class="kw">else</span> <span class="fl">0.2</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#The utility is assumed to be 0.7 if the leg is amputated and 0.9 if antibiotics are given. </span></span>
<span><span class="va">compute_utility</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">die</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">die</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span> <span class="fl">0</span> <span class="kw">else</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"Amputate"</span><span class="op">)</span> <span class="fl">0.7</span> <span class="kw">else</span> <span class="fl">0.9</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><code>pDie</code> is a simple function with a single
<code>if...else</code> statement. Similarly compute_utility is also a
simple function of the decision. Below we show how to make these a
function of prior events.</p>
<p>As your functions get more complex, we recommended that you test them
to make sure they return outcomes for all possible combinations of
decisions and event values. For example, the simple code below tests the
functions for all possible combinations of decisions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">decision</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Amputate"</span>, <span class="st">"Antibiotics"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">die</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"decision:"</span>, <span class="va">decision</span>, <span class="st">" die :"</span>, <span class="va">die</span>, <span class="st">" pDie:"</span>, <span class="fu">pDie</span><span class="op">(</span><span class="va">decision</span><span class="op">)</span>, <span class="st">" utility:"</span>, <span class="fu">compute_utility</span><span class="op">(</span><span class="va">decision</span>, <span class="va">die</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; decision: Amputate  die : TRUE  pDie: 0.01  utility: 0 </span></span>
<span><span class="co">#&gt; decision: Amputate  die : FALSE  pDie: 0.01  utility: 0.7 </span></span>
<span><span class="co">#&gt; decision: Antibiotics  die : TRUE  pDie: 0.2  utility: 0 </span></span>
<span><span class="co">#&gt; decision: Antibiotics  die : FALSE  pDie: 0.2  utility: 0.9</span></span></code></pre></div>
<p>It looks like the functions are returning the correct values for each
decision.</p>
</div>
<div class="section level3">
<h3 id="running-the-model">Running the model<a class="anchor" aria-label="anchor" href="#running-the-model"></a>
</h3>
<p>Now we have all the ingredients to run the model.</p>
<p>First, we need to generate the model function code</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_decision(mygmod): Model function my_decision_model is generated. It can be run by calling it directly:</span></span>
<span><span class="co">#&gt; my_decision_model(params)</span></span></code></pre></div>
<p>This will create the <code>model_struc</code> which contains the
model equations and formulae and can be examined, and as stated in the
generated note, this function also produces a function representation of
the decision model. The default name of this function is
<code>my_decision_model.</code></p>
<p>Let’s examine the content of these two object. First, let’s check the
model structure</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_struc</span> <span class="co"># returns the model structure including the formulae before evaluation</span></span>
<span><span class="co">#&gt; $decisions</span></span>
<span><span class="co">#&gt; [1] "Amputate"    "Antibiotics"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_decisions</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_events</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $final_outcomes</span></span>
<span><span class="co">#&gt; [1] "Dead"  "Alive"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_final_outcomes</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $events</span></span>
<span><span class="co">#&gt; [1] "die"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $payoffs</span></span>
<span><span class="co">#&gt; $payoffs$utility</span></span>
<span><span class="co">#&gt; compute_utility(decision, die)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $payoff_names</span></span>
<span><span class="co">#&gt; [1] "utility"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_payoffs</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $final_outcome_formulae</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   decision, final_outcome [4]</span></span></span>
<span><span class="co">#&gt;   decision    final_outcome path_id probs                     die   utility     </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Amputate    Alive               2 (1-(pDie('Amputate')))    FALSE compute_uti…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Amputate    Dead                1 (pDie('Amputate'))        TRUE  compute_uti…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Antibiotics Alive               2 (1-(pDie('Antibiotics'))) FALSE compute_uti…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Antibiotics Dead                1 (pDie('Antibiotics'))     TRUE  compute_uti…</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $summary_formulae</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   decision    utility                                                           </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Amputate    (1-(pDie('Amputate')))*compute_utility('Amputate', die=FALSE)+(pD…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Antibiotics (1-(pDie('Antibiotics')))*compute_utility('Antibiotics', die=FALS…</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "gmod_decision"</span></span></code></pre></div>
<p>examining the content of this structure can be helpful to debug a
model by examining the individual layers and formulae. For example
$final_outcome_formulae returns the probability and cost formulae for
each path and decision as plain text. These can be evaluated by calling
them directly if needed. For example, if we want to know what is the
probability of staying alive given Amputate, we can simply enter the
value of probs corresponding decision=Amputate and
final_outcome=Alive</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fu">pDie</span><span class="op">(</span><span class="st">'Amputate'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.99</span></span></code></pre></div>
<p>Next, we can also examine the contents of the my_markov_model
function which generates the text.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_decision_model</span> <span class="co">#without parenthesis returns the function text</span></span>
<span><span class="co">#&gt; function (params = NULL) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (!is.null(params)) </span></span>
<span><span class="co">#&gt;         list2env(params, envir = .GlobalEnv)</span></span>
<span><span class="co">#&gt;     summary_results &lt;- matrix(0, nrow = 2, ncol = 1, dimnames = list(c("Amputate", </span></span>
<span><span class="co">#&gt;         "Antibiotics"), c("utility")))</span></span>
<span><span class="co">#&gt;     summary_results["Amputate", "utility"] &lt;- (1 - (pDie("Amputate"))) * </span></span>
<span><span class="co">#&gt;         compute_utility("Amputate", die = FALSE) + (pDie("Amputate")) * </span></span>
<span><span class="co">#&gt;         compute_utility("Amputate", die = TRUE)</span></span>
<span><span class="co">#&gt;     summary_results["Antibiotics", "utility"] &lt;- (1 - (pDie("Antibiotics"))) * </span></span>
<span><span class="co">#&gt;         compute_utility("Antibiotics", die = FALSE) + (pDie("Antibiotics")) * </span></span>
<span><span class="co">#&gt;         compute_utility("Antibiotics", die = TRUE)</span></span>
<span><span class="co">#&gt;     return(summary_results)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;environment: 0x11183c370&gt;</span></span></code></pre></div>
<p>The generated code is relatively simple given our example. For more
involved examples, please check the HSE and Doubilet vignettes.</p>
<p>Now, let’s run the model function and generate our summary results of
the expected utility for each decision</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">my_decision_model</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;             utility</span></span>
<span><span class="co">#&gt; Amputate      0.693</span></span>
<span><span class="co">#&gt; Antibiotics   0.720</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-multiple-events">adding multiple events<a class="anchor" aria-label="anchor" href="#adding-multiple-events"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"Amputate"</span>, <span class="st">"Antibiotics"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"get_sick"</span>,  </span>
<span>            scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">T</span>, <span class="cn">F</span><span class="op">)</span>, </span>
<span>            probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pGetSick</span><span class="op">(</span><span class="va">decision</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>            outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"die"</span>, <span class="st">"die"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"die"</span>,  </span>
<span>            scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">T</span>, <span class="cn">F</span><span class="op">)</span>, </span>
<span>            probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pDie</span><span class="op">(</span><span class="va">get_sick</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>            outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dead"</span>, <span class="st">"Alive"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>utility <span class="op">=</span> <span class="fu">compute_utility</span><span class="op">(</span><span class="va">decision</span>, <span class="va">get_sick</span>, <span class="va">die</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define pGetSick prob of getting sick is low with amputate = 0.1 but antibiotics is higher 0.3</span></span>
<span><span class="va">pGetSick</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"Antibiotics"</span><span class="op">)</span> <span class="fl">0.3</span> <span class="kw">else</span> <span class="fl">0.1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># update probability of dying so it is a function of the prior event getting sick</span></span>
<span><span class="va">pDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">get_sick</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">get_sick</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="fl">0.2</span> <span class="kw">else</span> <span class="fl">0.01</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#similarly we can make the utility a function of multiple events</span></span>
<span><span class="va">compute_utility</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">get_sick</span>, <span class="va">die</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">u1</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">die</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span> <span class="fl">0</span> <span class="kw">else</span></span>
<span>          <span class="kw">if</span><span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"Amputate"</span><span class="op">)</span> <span class="fl">0.7</span> <span class="kw">else</span> <span class="fl">0.9</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">get_sick</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span>  <span class="va">u1</span><span class="op">*</span><span class="fl">0.7</span> <span class="kw">else</span> <span class="va">u1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_decision(mygmod): Model function my_decision_model is generated. It can be run by calling it directly:</span></span>
<span><span class="co">#&gt; my_decision_model(params)</span></span>
<span><span class="fu">my_decision_model</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;             utility</span></span>
<span><span class="co">#&gt; Amputate     0.6629</span></span>
<span><span class="co">#&gt; Antibiotics  0.7749</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="passing-a-parameter-list-to-the-model">passing a parameter list to the model<a class="anchor" aria-label="anchor" href="#passing-a-parameter-list-to-the-model"></a>
</h3>
<p>So far, we haven’t passed any parameter lists to the model. The model
has been retrieving the values it needs from the global environment or
the vignette’s environment. Below we show how to pass parameters as a
list:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pDieAmputate <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>               pDieAntibiotics <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>               uAmputate <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>               uAntibiotics <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>               uDead <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"Amputate"</span>, <span class="st">"Antibiotics"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"die"</span>,  </span>
<span>            scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">T</span>, <span class="cn">F</span><span class="op">)</span>, </span>
<span>            probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pDie</span><span class="op">(</span><span class="va">decision</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>            outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dead"</span>, <span class="st">"Alive"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>utility <span class="op">=</span> <span class="fu">compute_utility</span><span class="op">(</span><span class="va">decision</span>, <span class="va">die</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">decision</span> <span class="op">==</span> <span class="st">"Amputate"</span><span class="op">)</span> <span class="va">pDieAmputate</span> <span class="kw">else</span> <span class="va">pDieAntibiotics</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#The utility is assumed to be 0.7 if the leg is amputated and 0.9 if antibiotics are given. </span></span>
<span><span class="va">compute_utility</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decision</span>, <span class="va">die</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">die</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span> <span class="va">uDead</span> <span class="kw">else</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">decision</span><span class="op">==</span><span class="st">"Amputate"</span><span class="op">)</span> <span class="va">uAmputate</span> <span class="kw">else</span> <span class="va">uAntibiotics</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_decision(mygmod): Model function my_decision_model is generated. It can be run by calling it directly:</span></span>
<span><span class="co">#&gt; my_decision_model(params)</span></span>
<span><span class="fu">my_decision_model</span><span class="op">(</span>params <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span>
<span><span class="co">#&gt;             utility</span></span>
<span><span class="co">#&gt; Amputate      0.693</span></span>
<span><span class="co">#&gt; Antibiotics   0.720</span></span></code></pre></div>
<p>This can be particularly helpful when doing deterministic and
probabilistic sensitivity analyses where we can update the parameters in
the list and pass them to the model function.</p>
<p>In this vignettes we defined a decision model using gmod. We
illustrated how to add decisions and events and how to link the event
together. We illustrated how to make the probability of one event to
rely on previous events values. We showed how to reveal the model
structure and also the model function.</p>
<p>In addition, we illustrated how to add payoffs and make them
functions of the decisions and previous event values.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Hawre Jalal.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
