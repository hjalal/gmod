<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M3 Markov Tutorial Age Dependent • gmod</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="M3 Markov Tutorial Age Dependent">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gmod</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/D0_getting_started_decision_models.html">D0 getting started with decision models using gmod</a>
    </li>
    <li>
      <a href="../articles/D1_decision_tree_DARTH_HVE_example.html">D1 Decision Tree Herpes Virus Encephalopathy</a>
    </li>
    <li>
      <a href="../articles/D2_gmod_decision_tree.html">D2 Introduction to Decision Trees</a>
    </li>
    <li>
      <a href="../articles/D3_dec_tree_Doubilet_1985_example.html">D3 Herpes Simplex Decision Tree Example Doubilet 1985</a>
    </li>
    <li>
      <a href="../articles/M0_getting_started_markov_gmod.html">M0 gmod: getting started with building Markov models</a>
    </li>
    <li>
      <a href="../articles/M1_gmod_intro_markov_tutorial.html">M1 Introduction to Markov modeling</a>
    </li>
    <li>
      <a href="../articles/M2_gmod_advanced_markov_tutorial.html">M2 Advanced Markov Tutorial for Time Dependent Markov Model</a>
    </li>
    <li>
      <a href="../articles/M3_Markov_age_dep.html">M3 Markov Tutorial Age Dependent</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://www.dashlab.ca/projects/decision_twig/" class="external-link">DecisionTwig</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hjalal/gmod" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>M3 Markov Tutorial Age Dependent</h1>
            
      

      <div class="hidden name"><code>M3_Markov_age_dep.Rmd</code></div>

    </div>

    
    
<p>This vignette replicates the age dependent part of the Advanced
tutorial for Markov models in <em>Medical Decision Making</em>:</p>
<p><em>Alarid-Escudero, F., Krijkamp, E., Enns, E. A., Yang, A., Hunink,
M. M., Pechlivanoglou, P., &amp; Jalal, H. (2023). A tutorial on
time-dependent cohort state-transition models in r using a
cost-effectiveness analysis example. Medical Decision Making, 43(1),
21-41.</em></p>
<p>This vignette builds on the previous introductory tutorial. If you
haven’t already, please review the introductory Markov tutorial
first.</p>
<p>The outcomes may be slightly different from the tutorial. The reason
is that the tutorial applies a within cycle correction and also assumes
that transition rewards happen after the transition. gmod links the
transition rewards to the events so they occur during each cycle.</p>
<p>First, install gmod using devtools. Also, make sure to enable
use_vignettes so that vignettes render correctly.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#library(devtools)</span></span>
<span><span class="co">#install_github("hjalal/gmod", use_vignettes = TRUE, force = TRUE)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Please note that active development of gmod is now moved to twig. Please install twig https://hjalal.github.io/twig/ and review the vignettes for the latest features.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></code></pre></div>
<p>Define the model structure. Note that the model is structured in a
way that the event “die” happens first and if one survives they go to
the rest of the evnets, whether recover, getsick progress or stay in
their health state depending on where they were and the decision
taken</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mygmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod.html">gmod</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/decisions.html">decisions</a></span><span class="op">(</span><span class="st">"StandardOfCare"</span>, <span class="st">"StrategyA"</span>, <span class="st">"StrategyB"</span>, <span class="st">"StrategyAB"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/states.html">states</a></span><span class="op">(</span>names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"D"</span><span class="op">)</span>, </span>
<span>         init_probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"die"</span>,  </span>
<span>        scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">T</span>, <span class="cn">F</span><span class="op">)</span>, </span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pDie</span><span class="op">(</span><span class="va">state</span>, <span class="va">cycle</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>        outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"get_event"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="../reference/event.html">event</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"get_event"</span>,  </span>
<span>        scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"recover"</span>, <span class="st">"getsick"</span>, <span class="st">"progress"</span>, <span class="st">"stay"</span><span class="op">)</span>, </span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pRecover</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, </span>
<span>                  <span class="fu">pGetSick</span><span class="op">(</span><span class="va">state</span><span class="op">)</span>, </span>
<span>                  <span class="fu">pProgress</span><span class="op">(</span><span class="va">state</span>, <span class="va">decision</span><span class="op">)</span>, </span>
<span>                  <span class="cn">Inf</span><span class="op">)</span>, </span>
<span>                outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"curr_state"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="../reference/payoffs.html">payoffs</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu">cost</span><span class="op">(</span><span class="va">state</span>, <span class="va">decision</span>, <span class="va">get_event</span>, <span class="va">die</span><span class="op">)</span>, </span>
<span>          utility <span class="op">=</span> <span class="fu">utility</span><span class="op">(</span><span class="va">state</span>, <span class="va">decision</span>, <span class="va">get_event</span><span class="op">)</span>,</span>
<span>          discount_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.03</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/gmod.html">gmod()</a></code> function defines the model type as a Markov
model and number of cycles as 75. The <code>decision()</code> function
defines the treatment strategies. The <code>initial_probs()</code>
defines the initial probabilities. Here we only define the “Moderate”
states as the starting state with probability equals 1. The other states
will be set to 0.</p>
<p>Since the tutorial assumes that all the events happen simultaneously
(i.e., no sequence), we add a single <code>event_mapping()</code> layer
we model the individual final_outcomes separately. We can interpret the
event_mapping as the following: The event <code>get_event</code> can
have 5 values: recover, getsick, progress, die, or stay in the same
state. These values will outcome in the following states: H, S1, S2, D
and staying in the current state, respectively. The prob argument
defines the probability of these final_outcomes. For example, pRecover()
defins the probability of recovering and it is a function of state
because this probability is only applied if the state is “S1”, and is 0
otherwise. Note here we use <code>Inf</code> here is as a placeholder to
reduce the amount of typing required. Then, we define the payoffs of
cost and utility and define each as a function of the state and the
decision taken.</p>
<p>The <code>"curr_state"</code> is a build-in function that instructs
gmod to compute the probability of a state returning to itself.</p>
<p>Before we can evaluate the model, first we need to pass the parameter
values. Here we use the global environment to define those. Later, we
show how to pass these as a parameter list <code>param</code> which will
be helpful for analyses such as probabilistic sensitivity analyses.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_age_init</span> <span class="op">&lt;-</span> <span class="fl">25</span> <span class="op">-</span> <span class="fl">1</span> <span class="co"># age at baseline - gmod starts from cycle 1 instead of 0 as in the tutorial. </span></span>
<span><span class="va">n_age_max</span>  <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># maximum age of follow up</span></span>
<span></span>
<span><span class="co">### Transition rates (annual), and hazard ratios (HRs) ----</span></span>
<span><span class="va">r_HS1</span>  <span class="op">&lt;-</span> <span class="fl">0.15</span>  <span class="co"># constant annual rate of becoming Sick when Healthy</span></span>
<span><span class="va">r_S1H</span>  <span class="op">&lt;-</span> <span class="fl">0.5</span>   <span class="co"># constant annual rate of becoming Healthy when Sick</span></span>
<span><span class="va">r_S1S2</span> <span class="op">&lt;-</span> <span class="fl">0.105</span> <span class="co"># constant annual rate of becoming Sicker when Sick</span></span>
<span><span class="va">hr_S1</span>  <span class="op">&lt;-</span> <span class="fl">3</span>     <span class="co"># hazard ratio of death in Sick vs Healthy </span></span>
<span><span class="va">hr_S2</span>  <span class="op">&lt;-</span> <span class="fl">10</span>    <span class="co"># hazard ratio of death in Sicker vs Healthy </span></span>
<span></span>
<span><span class="co">### Effectiveness of treatment B ----</span></span>
<span><span class="va">hr_S1S2_trtB</span> <span class="op">&lt;-</span> <span class="fl">0.6</span>  <span class="co"># hazard ratio of becoming Sicker when Sick under treatment B</span></span>
<span></span>
<span><span class="co">## Age-dependent mortality rates ----</span></span>
<span><span class="va">lt_usa_2015</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"../inst/extdata/LifeTable_USA_Mx_2015.csv"</span><span class="op">)</span></span>
<span><span class="co">#* Extract age-specific all-cause mortality for ages in model time horizon</span></span>
<span><span class="va">v_r_mort_by_age</span> <span class="op">&lt;-</span> <span class="va">lt_usa_2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Age</span> <span class="op">&gt;=</span> <span class="va">n_age_init</span> <span class="op">&amp;</span> <span class="va">Age</span> <span class="op">&lt;</span> <span class="va">n_age_max</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Total</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># anyone above 100 have the same mortality</span></span></code></pre></div>
<p>Define the cost and utilities</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### State rewards ----</span></span>
<span><span class="co">#### Costs ----</span></span>
<span><span class="va">c_H</span>    <span class="op">&lt;-</span> <span class="fl">2000</span>  <span class="co"># annual cost of being Healthy</span></span>
<span><span class="va">c_S1</span>   <span class="op">&lt;-</span> <span class="fl">4000</span>  <span class="co"># annual cost of being Sick</span></span>
<span><span class="va">c_S2</span>   <span class="op">&lt;-</span> <span class="fl">15000</span> <span class="co"># annual cost of being Sicker</span></span>
<span><span class="va">c_D</span>    <span class="op">&lt;-</span> <span class="fl">0</span>     <span class="co"># annual cost of being dead</span></span>
<span><span class="va">c_trtA</span> <span class="op">&lt;-</span> <span class="fl">12000</span> <span class="co"># annual cost of receiving treatment A</span></span>
<span><span class="va">c_trtB</span> <span class="op">&lt;-</span> <span class="fl">13000</span> <span class="co"># annual cost of receiving treatment B</span></span>
<span><span class="co">#### Utilities ----</span></span>
<span><span class="va">u_H</span>    <span class="op">&lt;-</span> <span class="fl">1</span>     <span class="co"># annual utility of being Healthy</span></span>
<span><span class="va">u_S1</span>   <span class="op">&lt;-</span> <span class="fl">0.75</span>  <span class="co"># annual utility of being Sick</span></span>
<span><span class="va">u_S2</span>   <span class="op">&lt;-</span> <span class="fl">0.5</span>   <span class="co"># annual utility of being Sicker</span></span>
<span><span class="va">u_D</span>    <span class="op">&lt;-</span> <span class="fl">0</span>     <span class="co"># annual utility of being dead</span></span>
<span><span class="va">u_trtA</span> <span class="op">&lt;-</span> <span class="fl">0.95</span>  <span class="co"># annual utility when receiving treatment A</span></span>
<span></span>
<span><span class="co">### Transition rewards ----</span></span>
<span><span class="va">du_HS1</span> <span class="op">&lt;-</span> <span class="fl">0.01</span>  <span class="co"># disutility when the event get sick happens which is conditional on not dying.</span></span>
<span><span class="va">ic_HS1</span> <span class="op">&lt;-</span> <span class="fl">1000</span>  <span class="co"># increase in cost when the event get sick occurs conditional on not dying. </span></span>
<span><span class="va">ic_D</span>   <span class="op">&lt;-</span> <span class="fl">2000</span>  <span class="co"># increase in cost when the die event occurs.</span></span></code></pre></div>
<p>The model has six user-defined functions: four for computing
probabilities <code>pRecover()</code>, <code>pGetSick()</code>,
<code>pProgress()</code> and <code>pDie()</code>, and 2 for payoffs
<code>cost()</code> and <code>utility()</code>.</p>
<p>probability of recover is only dependent on state being S1 otherwise
is 0. Following the tutorial, we convert the rate of recover r_S1H to a
probability by using the function rate2prob().</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pRecover</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">rRecover</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">state</span><span class="op">==</span><span class="st">"S1"</span><span class="op">)</span> <span class="va">r_S1H</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span>  <span class="fu"><a href="../reference/rate2prob.html">rate2prob</a></span><span class="op">(</span><span class="va">rRecover</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This is a standard function and can be evaluated like any other
function. For example, we can type</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pRecover</span><span class="op">(</span><span class="st">"S1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3934693</span></span>
<span></span>
<span><span class="fu">pRecover</span><span class="op">(</span><span class="st">"S2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>probability of getting sick is also a function of a single state “H”
otherwise is 0.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pGetSick</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">rGetSick</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">state</span><span class="op">==</span><span class="st">"H"</span><span class="op">)</span> <span class="va">r_HS1</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span>  <span class="fu"><a href="../reference/rate2prob.html">rate2prob</a></span><span class="op">(</span><span class="va">rGetSick</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>probability of progress is slightly more complex as it is a function
of both the state and the decision.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pProgress</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">decision</span><span class="op">)</span><span class="op">{</span> <span class="co">#, cycle_in_S1){</span></span>
<span>  </span>
<span>  <span class="va">hr_S1S2</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">decision</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"StrategyB"</span>,<span class="st">"StrategyAB"</span><span class="op">)</span><span class="op">)</span> <span class="va">hr_S1S2_trtB</span> <span class="kw">else</span> <span class="fl">1</span></span>
<span>  <span class="va">rProgress</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">state</span><span class="op">==</span><span class="st">"S1"</span><span class="op">)</span> <span class="op">*</span> <span class="va">r_S1S2</span> <span class="op">*</span> <span class="va">hr_S1S2</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/rate2prob.html">rate2prob</a></span><span class="op">(</span><span class="va">rProgress</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>hr_S1S2 is a function of the decision if it contains “B” then it is
hr_S1S2_trtB otherwise is 1. then the rate of progression is only
conditional on state being S1 which gets multiplied by the r_S1S2 and
the hr_S1S2.</p>
<p>Using expressions such as (state==“S1”) are very helpful as they can
reduce the typing required and are easy to read once one gets using to
them. This expression is shorthand of a full if…then statement:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state</span> <span class="op">&lt;-</span> <span class="st">"S1"</span></span>
<span><span class="co"># these two statements are equivalent and both return TRUE:</span></span>
<span><span class="op">(</span><span class="va">state</span><span class="op">==</span><span class="st">"S1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">state</span><span class="op">==</span><span class="st">"S1"</span><span class="op">)</span> <span class="cn">TRUE</span> <span class="kw">else</span> <span class="cn">FALSE</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Probability of death is a function of the state. For states S1 and S2
the rate of mortality is relative to the healthy rate multiplied by a
hazard ratio for each state.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pDie</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">cycle</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">r_HD</span> <span class="op">&lt;-</span> <span class="va">v_r_mort_by_age</span><span class="op">[</span><span class="va">cycle</span><span class="op">]</span></span>
<span>  <span class="va">rDie</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, </span>
<span>         <span class="st">"H"</span> <span class="op">=</span> <span class="va">r_HD</span>,</span>
<span>         <span class="st">"S1"</span> <span class="op">=</span> <span class="va">r_HD</span><span class="op">*</span><span class="va">hr_S1</span>,</span>
<span>         <span class="st">"S2"</span> <span class="op">=</span> <span class="va">r_HD</span><span class="op">*</span><span class="va">hr_S2</span>,</span>
<span>         <span class="st">"D"</span> <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span> <span class="co">#translates to probability of 1</span></span>
<span>  <span class="fu"><a href="../reference/rate2prob.html">rate2prob</a></span><span class="op">(</span><span class="va">rDie</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The payoffs are a cost and utility function. Both are dependent on
both the state and the decision. For example only those in S1 and S2
receive treatment.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">decision</span>, <span class="va">get_event</span>, <span class="va">die</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># cost of decision is only applied if the state is either S1 or S2</span></span>
<span>  <span class="va">trans_cost_getting_sick</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">get_event</span><span class="op">==</span><span class="st">"getsick"</span><span class="op">)</span><span class="op">*</span><span class="va">ic_HS1</span> <span class="co"># increase in cost when transitioning from Healthy to Sick</span></span>
<span>  <span class="va">trans_cost_dying</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">die</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">*</span><span class="va">ic_D</span> <span class="co"># increase in cost when dying</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">state</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S1"</span>,<span class="st">"S2"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">c_decision</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">decision</span>,</span>
<span>                        <span class="st">"StandardOfCare"</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                        <span class="st">"StrategyA"</span> <span class="op">=</span> <span class="va">c_trtA</span> ,</span>
<span>                        <span class="st">"StrategyB"</span> <span class="op">=</span> <span class="va">c_trtB</span>,</span>
<span>                        <span class="st">"StrategyAB"</span> <span class="op">=</span> <span class="va">c_trtA</span> <span class="op">+</span> <span class="va">c_trtB</span><span class="op">)</span><span class="op">}</span></span>
<span>  <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">c_decision</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># cost of the state is a function of the state</span></span>
<span>  <span class="va">c_state</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, </span>
<span>         <span class="st">"H"</span> <span class="op">=</span> <span class="va">c_H</span>,</span>
<span>         <span class="st">"S1"</span> <span class="op">=</span> <span class="va">c_S1</span>,</span>
<span>         <span class="st">"S2"</span> <span class="op">=</span> <span class="va">c_S2</span>,</span>
<span>         <span class="st">"D"</span> <span class="op">=</span> <span class="va">c_D</span><span class="op">)</span></span>
<span>  <span class="co"># combine both</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">c_decision</span> <span class="op">+</span> <span class="va">c_state</span> <span class="op">+</span> <span class="va">trans_cost_getting_sick</span> <span class="op">+</span> <span class="va">trans_cost_dying</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Similarly the utility function is a function of the state and
decision. For H, S2 and D, the utility is independent of the decision.
But, Strategies involving “A” improve the utility of S1 from u_S1 to
u_trtA. One way to code this is:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">utility</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">state</span>, <span class="va">decision</span>, <span class="va">get_event</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">trans_util_getting_sick</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">du_HS1</span><span class="op">*</span><span class="op">(</span><span class="va">get_event</span><span class="op">==</span><span class="st">"getsick"</span><span class="op">)</span></span>
<span>  <span class="va">u_state</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">state</span>, </span>
<span>         <span class="st">"H"</span> <span class="op">=</span> <span class="va">u_H</span>,</span>
<span>         <span class="st">"S1"</span> <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">decision</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"StrategyA"</span>, <span class="st">"StrategyAB"</span><span class="op">)</span><span class="op">)</span> <span class="va">u_trtA</span> <span class="kw">else</span> <span class="va">u_S1</span>,</span>
<span>         <span class="st">"S2"</span> <span class="op">=</span> <span class="va">u_S2</span>,</span>
<span>         <span class="st">"D"</span> <span class="op">=</span> <span class="va">u_D</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">u_state</span> <span class="op">+</span> <span class="va">trans_util_getting_sick</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The output is the structure of the model including the formulae using
<code><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function()</a></code> and then calling the generated
function <code>my_markov_model()</code>.<br>
To evaluate the model, we run <code><a href="../reference/gmod_evaluate.html">gmod_evaluate()</a></code> which returns
the numerical outcomes.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_cycles</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">model_struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmod_gen_model_function.html">gmod_gen_model_function</a></span><span class="op">(</span><span class="va">mygmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in gmod_gen_model_function.gmod_markov(mygmod): Model function my_markov_model is generated. It can be run by calling it directly, for example this function returns the summary results:</span></span>
<span><span class="co">#&gt; my_markov_model(model_struc,params,return_transition_prob=FALSE,return_state_payoffs=FALSE,return_trace=FALSE,return_cycle_payoffs=FALSE,return_payoff_summary=TRUE)</span></span>
<span><span class="va">model_res</span> <span class="op">&lt;-</span> <span class="fu">my_markov_model</span><span class="op">(</span><span class="va">model_struc</span>, return_trace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#model_res</span></span></code></pre></div>
<p>The warning just indicates that no parameters were passed, so gmod
uses the values in the global environment. For analyses, such as
probabilistic sensitivity analysis (PSA), we can pass the parameters as
a list <code>param</code>.</p>
<p>We can load individual outcomes here that we are interested in. For
example, if we are interested in the Markov Trace of the Standard of
Care treatment, we can type:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_res</span><span class="op">$</span><span class="va">Trace</span></span>
<span><span class="co">#&gt; , , StandardOfCare</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H        S1         S2           D</span></span>
<span><span class="co">#&gt; 1  1.0000000 0.0000000 0.00000000 0.000000000</span></span>
<span><span class="co">#&gt; 2  0.8598357 0.1391509 0.00000000 0.001013486</span></span>
<span><span class="co">#&gt; 3  0.7939162 0.1899669 0.01382842 0.002288444</span></span>
<span><span class="co">#&gt; 4  0.7571058 0.2064451 0.03255561 0.003893471</span></span>
<span><span class="co">#&gt; 5  0.7319044 0.2096413 0.05271416 0.005740082</span></span>
<span><span class="co">#&gt; 6  0.7114248 0.2077181 0.07292855 0.007928592</span></span>
<span><span class="co">#&gt; 7  0.6930599 0.2038953 0.09271446 0.010330419</span></span>
<span><span class="co">#&gt; 8  0.6757341 0.1993907 0.11184616 0.013029051</span></span>
<span><span class="co">#&gt; 9  0.6590119 0.1946753 0.13021137 0.016101511</span></span>
<span><span class="co">#&gt; 10 0.6427558 0.1899520 0.14781676 0.019475491</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , StrategyA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H        S1         S2           D</span></span>
<span><span class="co">#&gt; 1  1.0000000 0.0000000 0.00000000 0.000000000</span></span>
<span><span class="co">#&gt; 2  0.8598357 0.1391509 0.00000000 0.001013486</span></span>
<span><span class="co">#&gt; 3  0.7939162 0.1899669 0.01382842 0.002288444</span></span>
<span><span class="co">#&gt; 4  0.7571058 0.2064451 0.03255561 0.003893471</span></span>
<span><span class="co">#&gt; 5  0.7319044 0.2096413 0.05271416 0.005740082</span></span>
<span><span class="co">#&gt; 6  0.7114248 0.2077181 0.07292855 0.007928592</span></span>
<span><span class="co">#&gt; 7  0.6930599 0.2038953 0.09271446 0.010330419</span></span>
<span><span class="co">#&gt; 8  0.6757341 0.1993907 0.11184616 0.013029051</span></span>
<span><span class="co">#&gt; 9  0.6590119 0.1946753 0.13021137 0.016101511</span></span>
<span><span class="co">#&gt; 10 0.6427558 0.1899520 0.14781676 0.019475491</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , StrategyB</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H        S1          S2           D</span></span>
<span><span class="co">#&gt; 1  1.0000000 0.0000000 0.000000000 0.000000000</span></span>
<span><span class="co">#&gt; 2  0.8598357 0.1391509 0.000000000 0.001013486</span></span>
<span><span class="co">#&gt; 3  0.7939162 0.1953247 0.008470643 0.002288444</span></span>
<span><span class="co">#&gt; 4  0.7592072 0.2166710 0.020268118 0.003853620</span></span>
<span><span class="co">#&gt; 5  0.7377216 0.2234403 0.033235108 0.005602964</span></span>
<span><span class="co">#&gt; 6  0.7218365 0.2240962 0.046446164 0.007621213</span></span>
<span><span class="co">#&gt; 7  0.7084326 0.2222402 0.059542002 0.009785170</span></span>
<span><span class="co">#&gt; 8  0.6961415 0.2193453 0.072344049 0.012169122</span></span>
<span><span class="co">#&gt; 9  0.6843753 0.2160275 0.084758295 0.014838971</span></span>
<span><span class="co">#&gt; 10 0.6729252 0.2125690 0.096774962 0.017730805</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , StrategyAB</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            H        S1          S2           D</span></span>
<span><span class="co">#&gt; 1  1.0000000 0.0000000 0.000000000 0.000000000</span></span>
<span><span class="co">#&gt; 2  0.8598357 0.1391509 0.000000000 0.001013486</span></span>
<span><span class="co">#&gt; 3  0.7939162 0.1953247 0.008470643 0.002288444</span></span>
<span><span class="co">#&gt; 4  0.7592072 0.2166710 0.020268118 0.003853620</span></span>
<span><span class="co">#&gt; 5  0.7377216 0.2234403 0.033235108 0.005602964</span></span>
<span><span class="co">#&gt; 6  0.7218365 0.2240962 0.046446164 0.007621213</span></span>
<span><span class="co">#&gt; 7  0.7084326 0.2222402 0.059542002 0.009785170</span></span>
<span><span class="co">#&gt; 8  0.6961415 0.2193453 0.072344049 0.012169122</span></span>
<span><span class="co">#&gt; 9  0.6843753 0.2160275 0.084758295 0.014838971</span></span>
<span><span class="co">#&gt; 10 0.6729252 0.2125690 0.096774962 0.017730805</span></span></code></pre></div>
<p>Similarly, we can load the summary outcomes of the costs and utility
of the strategies, such that:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_res</span><span class="op">$</span><span class="va">summary_payoffs</span></span>
<span><span class="co">#&gt;                    cost  utility</span></span>
<span><span class="co">#&gt; StandardOfCare 28525.55 8.067497</span></span>
<span><span class="co">#&gt; StrategyA      52980.50 8.367632</span></span>
<span><span class="co">#&gt; StrategyB      51650.73 8.140316</span></span>
<span><span class="co">#&gt; StrategyAB     75088.41 8.461766</span></span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.dashlab.ca" class="external-link">Hawre Jalal</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
